"use strict";(self.webpackChunkteck=self.webpackChunkteck||[]).push([[455],{13367:function(ke,G,c){c.d(G,{m:function(){return M}});var y=c(97685),P=c(15671),b=c(43144),M=function(){function h(){(0,P.Z)(this,h)}return(0,b.Z)(h,null,[{key:"fileExtensionValidator",value:function(L){return function(F){var B=!0;if(F.value){var T=F.value.name.split(".").pop();L.split(",").forEach(function(Y){Y.trim()===T&&(B=!1)})}return B?{inValidExt:!0}:null}}},{key:"benchLevelValidator",value:function(L){var F=+L.value;if(isNaN(F)||""===L.value.trim())return{isNan:!0};if(isFinite(F)){var j=L.value.includes("."),w=L.value.split("."),A=(0,y.Z)(w,2),Z=A[0],U=A[1];if(Z.length<3||Z.length>4)return{invalidNumber:!0};if(j&&!U||U&&1!==U.length)return{invalidNumber:!0}}return null}}]),h}()},50455:function(ke,G,c){c.r(G),c.d(G,{PlannedBenchesModule:function(){return En}});var y=c(43144),P=c(15671),b=c(69808),M=c(93075),h=c(77093),I=c(23322),L=c(56121),F=c(47423),B=c(77446),T=c(48966),Y=c(25245),j=c(74107),w=c(29772),A=c(90149),Z=c(34594),U=c(85899),ae=c(79814),ie=c(42585),Be=c(1302),Ze=c(30587),le=c(30325),re=c(73237),se=c(61120),q=c(60136),z=c(57777),C=c(46940),Ne=c(75778),ce=c(87545),x=c(7625),K=c(89255),X=c(19855),H=c(21347),De=function(){function a(){(0,P.Z)(this,a)}return(0,y.Z)(a,null,[{key:"getImportDialogTemplateConfig",value:function(n,o,l){var t=o.includes(n),i="column";return{formAdditionalClass:t?"short":"",layoutDirection:t?i:"row",layoutPositioning:t?"row":i,isRadioVisible:t,radio:t?"":i,isCoalSeamRadioButtonDisabled:!!l,isEditMode:!!l}}}]),a}(),_e=c(13367),Ee=c(94424),Ie=c.n(Ee),e=c(65542),S=c(94720),v=c(81186),be=c(21265),Ce=c(67322),we=c(90508),Re=["benchLevel"];function Ue(a,r){1&a&&(e.TgZ(0,"h2"),e._uU(1,"Import File"),e.qZA())}function Je(a,r){1&a&&(e.TgZ(0,"h2"),e._uU(1,"Edit coal seam file"),e.qZA())}function Ye(a,r){1&a&&e._UZ(0,"span",31)}function He(a,r){1&a&&(e.TgZ(0,"span"),e._uU(1,"Specify Mining Area, Bench level and file(s) for import:"),e.qZA())}function Qe(a,r){if(1&a&&(e.TgZ(0,"mat-option",32),e._uU(1),e.qZA()),2&a){var n=r.$implicit;e.Q6J("value",n.id),e.xp6(1),e.hij(" ",n.name," ")}}function Ve(a,r){if(1&a&&(e.TgZ(0,"div",33)(1,"div",34)(2,"label",35),e._uU(3,"Pattern type: "),e.qZA(),e.TgZ(4,"mat-radio-group",36)(5,"mat-radio-button",37),e._uU(6," Waste "),e.qZA(),e.TgZ(7,"div",38)(8,"mat-radio-button",39),e._uU(9," Ore "),e.qZA(),e.TgZ(10,"mat-checkbox",40),e._uU(11," Preconditioning "),e.qZA()()()()()),2&a){var n=e.oxw();e.xp6(2),e.ekj("form__label--error",n.getFormControl("patternType").touched&&!n.getFormControl("patternType").valid),e.xp6(3),e.ekj("cursor--not-allowed",n.templateConfig.isDesignBenchRadioButtonDisabled)("disabled",n.templateConfig.isCoalSeamRadioButtonDisabled),e.Q6J("disableRipple",!0)("disabled",n.templateConfig.isDesignBenchRadioButtonDisabled),e.xp6(2),e.ekj("checked",n.isOreSelected),e.xp6(1),e.ekj("cursor--not-allowed",n.templateConfig.isDesignBenchRadioButtonDisabled)("disabled",n.templateConfig.isCoalSeamRadioButtonDisabled),e.Q6J("checked",!0)("disableRipple",!0)("disabled",n.templateConfig.isDesignBenchRadioButtonDisabled),e.xp6(2),e.Q6J("disableRipple",!0)}}function We(a,r){if(1&a&&(e.TgZ(0,"div",41)(1,"label",42),e._uU(2,"File type:"),e.qZA(),e.TgZ(3,"mat-radio-group",43)(4,"mat-radio-button",44),e._uU(5," Design Area polygon "),e.qZA(),e.TgZ(6,"mat-radio-button",44),e._uU(7," Top Coal seam "),e.qZA(),e.TgZ(8,"mat-radio-button",44),e._uU(9," Bottom Coal seam "),e.qZA()()()),2&a){var n=e.oxw();e.xp6(4),e.ekj("cursor--not-allowed",n.templateConfig.isDesignBenchRadioButtonDisabled)("disabled",n.templateConfig.isCoalSeamRadioButtonDisabled),e.Q6J("disabled",n.templateConfig.isDesignBenchRadioButtonDisabled)("value","designBench"),e.xp6(2),e.ekj("disabled",n.templateConfig.isCoalSeamRadioButtonDisabled),e.Q6J("disabled",n.templateConfig.isCoalSeamRadioButtonDisabled)("value","top"),e.xp6(2),e.ekj("disabled",n.templateConfig.isCoalSeamRadioButtonDisabled),e.Q6J("disabled",n.templateConfig.isCoalSeamRadioButtonDisabled)("value","bottom")}}function $e(a,r){if(1&a&&(e.TgZ(0,"div",45),e._uU(1),e.ALo(2,"titlecase"),e.ALo(3,"titlecase"),e.qZA()),2&a){var n=e.oxw();e.xp6(1),e.HOy(" ",e.lcZ(2,4,n.getFormControl("fileType").value)," coal seam file for elevation level ",n.getFormControl("benchLevel").value,", ",n.getFormControl("miningArea").value," mining area already exists. By clicking \u201cConfirm\u201d it will be overwritten. If you want to keep current ",e.lcZ(3,6,n.getFormControl("fileType").value)," coal seams, click \u201cCancel\u201d or choose another mining area, elevation level, or file type. ")}}function Ge(a,r){if(1&a){var n=e.EpF();e.TgZ(0,"span",48),e.NdJ("click",function(){return e.CHM(n),e.oxw(2).removeFile()}),e.qZA()}}function je(a,r){if(1&a&&(e.TgZ(0,"div",46),e._uU(1),e.YNc(2,Ge,1,0,"span",47),e.qZA()),2&a){var n=e.oxw();e.xp6(1),e.hij(" ",n.getFormControl("file").value.name," "),e.xp6(1),e.Q6J("ngIf",!n.fileIsUploading)}}function qe(a,r){1&a&&(e.TgZ(0,"span"),e._uU(1,"Choose file ..."),e.qZA())}function ze(a,r){1&a&&(e.TgZ(0,"span"),e._uU(1,"Replace file ..."),e.qZA())}function Ke(a,r){if(1&a){var n=e.EpF();e.TgZ(0,"button",49),e.NdJ("click",function(){return e.CHM(n),e.oxw(),e.MAs(36).click()}),e.YNc(1,qe,2,0,"span",0),e.YNc(2,ze,2,0,"span",0),e.qZA()}if(2&a){var o=e.oxw();e.xp6(1),e.Q6J("ngIf",!o.templateConfig.isEditMode),e.xp6(1),e.Q6J("ngIf",o.templateConfig.isEditMode)}}function Xe(a,r){1&a&&(e.TgZ(0,"div",50),e._uU(1," Wrong file type or extension. Please choose a correct file. "),e.qZA())}function et(a,r){if(1&a&&(e.TgZ(0,"div",50)(1,"p"),e._uU(2),e.qZA()()),2&a){var n=e.oxw();e.xp6(2),e.Oqu(n.formErrorMessage)}}var tt=H.q.EVO,nt=H.q.FRO,ot=H.q.GHO,at=H.q.LCO,ye=function(){var a=function(r){(0,q.Z)(o,r);var n=(0,z.Z)(o);function o(l,t,i,s,d,g,p,u){var m;return(0,P.Z)(this,o),(m=n.call(this)).data=l,m.mineStateService=t,m.treeStateService=i,m.formBuilder=s,m.plannedBenchesApiService=d,m.cdr=g,m.customEventService=p,m.dialogRef=u,m.mineSites=[],m.fileIsUploading=!1,m.formUploadingError=!1,m.formErrorMessage=null,m.minesWithCoalSeamUpload=[tt,nt,ot,at],m.form=m.formBuilder.group({miningArea:["",{validators:[M.kI.required]}],benchLevel:["",{validators:[_e.m.benchLevelValidator,M.kI.required]}],fileType:["",{validators:[M.kI.required]}],file:[null,{validators:[M.kI.required,_e.m.fileExtensionValidator("dxf")]}],patternType:["ore",{validators:[M.kI.required]}],preconditioning:[!1,{validators:[M.kI.required]}]}),m.form.valueChanges.subscribe(function(){m.isCurrentElevationSeamExist()}),m.getFormControl("patternType").valueChanges.subscribe(function(){m.controlPreconditioningState()}),m}return(0,y.Z)(o,[{key:"isHVC",get:function(){return C.ZA.isHVC(this.mineStateService.getSelectedMineArea())}},{key:"isOreSelected",get:function(){return"ore"===this.getFormControl("patternType").value}},{key:"ngOnInit",value:function(){this.getMineSites()}},{key:"ngAfterViewChecked",value:function(){this.setBenchLevelFocus()}},{key:"getFormControl",value:function(t){return this.form.get(t)}},{key:"getFileTree",value:function(){return this.treeStateService.fileTree$.getValue()}},{key:"isCurrentElevationSeamExist",value:function(){var t=this;try{var i=this.getFileTree(),s=i.findIndex(function(p){return p.name===t.getFormControl("miningArea").value}),d=i[s].children.findIndex(function(p){return String(p.name)===t.getFormControl("benchLevel").value}),g=i[s].children[d].children.find(function(p){return p.coalSeamType===t.getFormControl("fileType").value.toUpperCase()});this.nodeUUID=g.uuid,this.isElevationSeamExist=!!g}catch(p){this.nodeUUID=null,this.isElevationSeamExist=!1}}},{key:"getMineSites",value:function(){var t=this,i=this.mineStateService.getSelectedMineArea(),s=this.data?this.data.fileNode:null;if(this.form.patchValue({fileType:"designBench"},{emitEvent:!1}),this.templateConfig=De.getImportDialogTemplateConfig(i,this.minesWithCoalSeamUpload,s),this.templateConfig.isEditMode)for(var d in this.form.patchValue({miningArea:s.miningArea,benchLevel:String(s.benchLevel),fileType:s.coalSeamType.toLowerCase()},{emitEvent:!0}),this.form.controls)this.form.controls.hasOwnProperty(d)&&"file"!==d&&this.form.controls[d].disable();Ie().getItem("tree_view_".concat(i)).then(function(g){g.forEach(function(p){t.mineSites.push({name:p.name,id:p.id})}),t.selected="selected",t.cdr.detectChanges()})}},{key:"closeModal",value:function(){this.dialogRef.close()}},{key:"onFileSelect",value:function(t){var s=t.target;this.form.patchValue({file:t.target.files[0]}),this.getFormControl("file").updateValueAndValidity(),s.value="",this.formErrorMessage=null}},{key:"removeFile",value:function(){this.form.patchValue({file:null}),this.getFormControl("file").updateValueAndValidity()}},{key:"submitForm",value:function(){var t=new FormData,i=this.getFormControl("fileType").value;this.customEventService.event(K.R.UPLOAD_FILE,{file_type:i,page:X.K.PLANNED_BENCHES}),this.fileIsUploading=!0,this.isElevationSeamExist?(t.append("file",this.getFormControl("file").value),this.plannedBenchesApiService.updateCoalSeamFile(t,this.nodeUUID).pipe((0,x.R)(this.destroy$)).subscribe(this.requestComplete(),this.requestError())):(t.append("miningArea",this.getFormControl("miningArea").value),t.append("benchLevel",this.getFormControl("benchLevel").value),t.append("file",this.getFormControl("file").value),"designBench"!==i&&t.append("coalSeamType",i.toUpperCase()),this.isHVC&&this.setMetalMinesPayload(t),this.plannedBenchesApiService.uploadFile(t,i).pipe((0,x.R)(this.destroy$)).subscribe(this.requestComplete(),this.requestError()))}},{key:"setMetalMinesPayload",value:function(t){t.append("patternType",this.getFormControl("patternType").value),t.append("preconditioning",this.getFormControl("preconditioning").value)}},{key:"requestComplete",value:function(){var t=this;return function(){t.fileIsUploading=!1,t.formUploadingError=!1,t.formErrorMessage=null,t.dialogRef.close(!0)}}},{key:"requestError",value:function(){var t=this;return function(i){var s,d,g,p=null!==(g=null!==(d=null===(s=null==i?void 0:i.error)||void 0===s?void 0:s.error)&&void 0!==d?d:null==i?void 0:i.message)&&void 0!==g?g:"",u=null==i?void 0:i.status;if(409===u){if(t.isCurrentElevationSeamExist(),t.isElevationSeamExist)return t.fileIsUploading=!1,t.formUploadingError=!1,void(t.formErrorMessage=null);t.formErrorMessage="".concat(p," Please refresh the page.")}else u<500&&p.includes("type")?(t.getFormControl("file").setErrors({inValidExt:!0}),t.formErrorMessage="Server response: ".concat(p)):t.formErrorMessage=u>=500?"Something went wrong. Please try again.":"Something went wrong. Please check your internet connection and try again.";t.fileIsUploading=!1,t.formUploadingError=!0}}},{key:"setBenchLevelFocus",value:function(){var t=this.getFormControl("miningArea"),i=this.getFormControl("benchLevel");t.value&&!i.touched&&(this.benchLevelInput.nativeElement.focus(),this.cdr.detectChanges())}},{key:"controlPreconditioningState",value:function(){var t=this.getFormControl("preconditioning");this.isOreSelected?t.enable():(t.setValue(!1),t.disable())}}]),o}(C.eO);return a.\u0275fac=function(n){return new(n||a)(e.Y36(T.WI),e.Y36(S.Hj),e.Y36(S.bC),e.Y36(M.qu),e.Y36(v.I),e.Y36(e.sBO),e.Y36(S.qL),e.Y36(T.so))},a.\u0275cmp=e.Xpm({type:a,selectors:[["dabo-files-import-dialog"]],viewQuery:function(n,o){var l;1&n&&e.Gf(Re,7),2&n&&e.iGM(l=e.CRH())&&(o.benchLevelInput=l.first)},features:[e.qOj],decls:45,vars:39,consts:[[4,"ngIf"],[1,"fill-remaining-space"],["class","icon icon-close","mat-dialog-close","",4,"ngIf"],["daboKeydownEscape","","fxFill","",3,"fxShow","keydownEmitter"],["color","primary","mode","indeterminate"],[1,"container__form",3,"formGroup"],[3,"fxLayout"],["fxLayout","column",1,"dropdown-wrapper"],["fxLayoutGap","10px",3,"fxLayout"],["fxFlex","50%","fxLayout","column",1,"form-field-wrapper"],["for","mineSiteId",1,"form__label"],["floatLabel","never","hideRequiredMarker","",1,"mat-select--custom"],["formControlName","miningArea","panelClass","mat-select__mine-sites","id","mineSiteId"],[3,"value",4,"ngFor","ngForOf"],["for","benchLevel",1,"form__label"],["formControlName","benchLevel","id","benchLevel","placeholder","eg. 1423.5","type","text",1,"base-text-input"],["benchLevel",""],["class","form-field-wrapper","fxFlex","100%","fxLayout","row",4,"ngIf"],["class","radio-wrapper",4,"ngIf"],["class","form__label--red",4,"ngIf"],["fxLayout","row",1,"file-choose"],["fxFlex","100%","fxLayout","column",1,"form-field-wrapper"],[1,"form__label","mt-8"],["class","file-info",4,"ngIf"],["accept",".dxf","id","input-file-id","type","file",1,"hidden",3,"change"],["fileUpload",""],["class","btn-upload active btn btn--xs btn--primary btn--orange","mat-button","",3,"click",4,"ngIf"],["class","text-error",4,"ngIf"],["align","center","fxLayoutGap","12px"],["fxFlex","calc(50% - 10px)","mat-button","","mat-dialog-close","","tabindex","-1",1,"modal__btn","btn","btn--secondary",3,"disabled"],["fxFlex","calc(50% - 10px)","mat-button","",1,"modal__btn","btn","btn--primary",3,"disabled","click"],["mat-dialog-close","",1,"icon","icon-close"],[3,"value"],["fxFlex","100%","fxLayout","row",1,"form-field-wrapper"],["fxFlex","100%","fxLayout","column",1,"form-group__pattern-type"],["for","patternType","fxFlex","100%",1,"form__label"],["formControlName","patternType","fxFlex","100","fxLayout","row","fxLayoutAlign","start center","id","patternType"],["value","waste",3,"disableRipple","disabled"],[1,"form-group__pattern-type--mixed"],["value","ore",3,"checked","disableRipple","disabled"],["formControlName","preconditioning",1,"example-margin",3,"disableRipple"],[1,"radio-wrapper"],["for","radioButtonGroupId",1,"form__label"],["formControlName","fileType","fxLayout","column","id","radioButtonGroupId"],[3,"disabled","value"],[1,"form__label--red"],[1,"file-info"],["class","icon icon-close",3,"click",4,"ngIf"],[1,"icon","icon-close",3,"click"],["mat-button","",1,"btn-upload","active","btn","btn--xs","btn--primary","btn--orange",3,"click"],[1,"text-error"]],template:function(n,o){1&n&&(e.TgZ(0,"mat-toolbar")(1,"mat-toolbar-row"),e.YNc(2,Ue,2,0,"h2",0),e.YNc(3,Je,2,0,"h2",0),e._UZ(4,"div",1),e.YNc(5,Ye,1,0,"span",2),e.qZA()(),e.TgZ(6,"div",3),e.NdJ("keydownEmitter",function(){return o.closeModal()}),e._UZ(7,"mat-progress-bar",4),e.qZA(),e.TgZ(8,"mat-dialog-content"),e.YNc(9,He,2,0,"span",0),e.TgZ(10,"form",5)(11,"div",6)(12,"div",7)(13,"div",8)(14,"div",9)(15,"label",10),e._uU(16," Mining Area: "),e.qZA(),e.TgZ(17,"mat-form-field",11)(18,"mat-label"),e._uU(19," Select "),e.qZA(),e.TgZ(20,"mat-select",12),e.YNc(21,Qe,2,2,"mat-option",13),e.qZA()()(),e.TgZ(22,"div",9)(23,"label",14),e._uU(24," Bench level: "),e.qZA(),e._UZ(25,"input",15,16),e.qZA()()(),e.YNc(27,Ve,12,18,"div",17),e.YNc(28,We,10,14,"div",18),e.qZA(),e.YNc(29,$e,4,8,"div",19),e.TgZ(30,"div",20)(31,"div",21)(32,"label",22),e._uU(33,"Select your local (.dxf) file:"),e.qZA(),e.YNc(34,je,3,2,"div",23),e.TgZ(35,"input",24,25),e.NdJ("change",function(t){return o.onFileSelect(t)}),e.qZA(),e.YNc(37,Ke,3,2,"button",26),e.YNc(38,Xe,2,0,"div",27),e.YNc(39,et,3,1,"div",27),e.qZA()()()(),e.TgZ(40,"mat-dialog-actions",28)(41,"button",29),e._uU(42," Cancel "),e.qZA(),e.TgZ(43,"button",30),e.NdJ("click",function(){return o.submitForm()}),e._uU(44," Confirm "),e.qZA()()),2&n&&(e.xp6(2),e.Q6J("ngIf",!o.templateConfig.isEditMode),e.xp6(1),e.Q6J("ngIf",o.templateConfig.isEditMode),e.xp6(2),e.Q6J("ngIf",!o.fileIsUploading),e.xp6(1),e.Q6J("fxShow",o.fileIsUploading),e.xp6(3),e.Q6J("ngIf",!o.templateConfig.isEditMode),e.xp6(1),e.Q6J("formGroup",o.form),e.xp6(1),e.s9C("fxLayout",o.templateConfig.layoutPositioning),e.xp6(2),e.Gre("file-specs ",o.templateConfig.formAdditionalClass,""),e.s9C("fxLayout",o.templateConfig.layoutDirection),e.xp6(4),e.ekj("cursor--not-allowed",o.templateConfig.isCoalSeamRadioButtonDisabled)("mat-select--disabled",o.templateConfig.isCoalSeamRadioButtonDisabled),e.xp6(1),e.ekj("select--label",o.getFormControl("miningArea").touched)("select--label--focus",!o.getFormControl("miningArea").touched),e.xp6(2),e.ekj("mat-select--focus",!o.getFormControl("miningArea").touched),e.xp6(1),e.Q6J("ngForOf",o.mineSites),e.xp6(2),e.ekj("form__label--error",o.getFormControl("benchLevel").touched&&!o.getFormControl("benchLevel").valid),e.xp6(2),e.ekj("base-text-input--disabled",o.templateConfig.isCoalSeamRadioButtonDisabled)("cursor--not-allowed",o.templateConfig.isCoalSeamRadioButtonDisabled)("ng-invalid",o.getFormControl("benchLevel").touched&&!o.getFormControl("benchLevel").valid),e.xp6(2),e.Q6J("ngIf",o.isHVC),e.xp6(1),e.Q6J("ngIf",o.templateConfig.isRadioVisible),e.xp6(1),e.Q6J("ngIf",o.isElevationSeamExist&&!o.templateConfig.isEditMode),e.xp6(5),e.Q6J("ngIf",o.getFormControl("file").valid),e.xp6(3),e.Q6J("ngIf",o.getFormControl("file").invalid),e.xp6(1),e.Q6J("ngIf",o.getFormControl("file").value&&(null==o.getFormControl("file").errors?null:o.getFormControl("file").errors.inValidExt)),e.xp6(1),e.Q6J("ngIf",o.formErrorMessage),e.xp6(2),e.Q6J("disabled",o.fileIsUploading),e.xp6(2),e.Q6J("disabled",!o.form.valid||o.fileIsUploading||(null==o.form.controls.file.errors?null:o.form.controls.file.errors.inValidExt)||(null==o.form.controls.benchLevel.errors?null:o.form.controls.benchLevel.errors.invalidElevation)))},directives:[Z.Ye,Z.rD,b.O5,T.ZT,be.h,h.s9,I.b8,U.pW,T.xY,M._Y,M.JL,M.sg,h.xw,h.SQ,h.yH,Ce.KE,Ce.hX,j.gD,M.JJ,M.u,b.sg,we.ey,M.Fj,ae.VQ,h.Wh,ae.U0,B.oG,F.lW,T.H8],pipes:[b.rS],encapsulation:2}),a}(),it=c(98711),O=c(99191),lt=c(16952),rt=c(52012),st=c(37143),de=c(97685),D=c(89062),Pe=c(20449),ct=c(28258),dt=c(57676),pt=c(70655),W=c(338),N=c(65062),gt=W.A.TOP,ut=W.A.BOTTOM,$=N.e,Q=function(){function a(){(0,P.Z)(this,a)}return(0,y.Z)(a,null,[{key:"isSelectableNode",value:function(n){return!(1!==n.level&&2!==n.level||n.status!==O.Z.SUCCESS&&null!==n.status)}},{key:"mapToFlat",value:function(n,o,l){var t=o.name,i=o.filename,s=o.polygonName,d=o.children,g=o.status,p=(0,pt._T)(o,["name","filename","polygonName","children","status"]);return n.expandable=!(!d||!d.length||g&&g!==O.Z.SUCCESS),n.level=l,n.name=t||i||s,n.benchLevel=p.benchLevel,n.uuid=p.uuid,n.miningArea=p.miningArea,n.status=g,n.type=p.type,n.statusMessage=p.statusMessage,n.statusDescription=p.statusDescription,n.coalSeamType=p.coalSeamType,d&&(n.children=d),n}},{key:"getNodePosition",value:function(n,o){if(o.type!==$.COAL_SEAM)return S.bC.findAlphabeticPosition(n.children,o.filename,function(i){return i.filename});var l=n.children.find(function(i){return i.type===$.COAL_SEAM&&i.coalSeamType===gt}),t=n.children.find(function(i){return i.type===$.COAL_SEAM&&i.coalSeamType===ut});return l&&t?null:l?t?null:1:0}},{key:"groupNodesByType",value:function(n){return n.reduce(function(o,l){return l.type===$.COAL_SEAM?[(0,D.Z)(o[0]),[].concat((0,D.Z)(o[1]),[l.uuid])]:l.type===$.POLYGONS?[[].concat((0,D.Z)(o[0]),[l.uuid]),(0,D.Z)(o[1])]:void 0},[[],[]])}}]),a}(),mt=(0,y.Z)(function a(){(0,P.Z)(this,a)}),Me=c(53773),Te=c(17489),pe=c(92198),ft=c(87224);function ht(a,r){if(1&a&&(e.TgZ(0,"h3",7),e._uU(1),e.ALo(2,"titlecase"),e.qZA()),2&a){var n=e.oxw();e.xp6(1),e.HOy(" Are you sure you want to delete ",e.lcZ(2,4,n.data.fileNode.coalSeamType)," Coal seam file \u201c",n.data.fileNode.name,"\u201c for elevation level ",n.data.fileNode.benchLevel,", ",n.data.fileNode.miningArea," mining area? ")}}function vt(a,r){if(1&a&&(e.TgZ(0,"h3",7),e._uU(1),e.qZA()),2&a){var n=e.oxw();e.xp6(1),e.lnq(" Are you sure you want to delete Design Area Polygon file \u201c",n.data.fileNode.name,"\u201c for elevation level ",n.data.fileNode.benchLevel,", ",n.data.fileNode.miningArea," mining area? ")}}function _t(a,r){1&a&&(e.TgZ(0,"span",8),e._uU(1," This could lead to removing related patterns from the Predictions Tracking widget on the Site-level Dashboard. "),e.qZA())}var bt=function(){var a=function(){function r(n,o,l,t){(0,P.Z)(this,r),this.data=n,this.dialogRef=o,this.plannedBenchesApiService=l,this.mineStateService=t}return(0,y.Z)(r,[{key:"isCoalSeam",get:function(){return this.data.fileNode.type===N.e.COAL_SEAM}},{key:"isHVCMine",get:function(){return C.ZA.isHVC(this.mineStateService.getSelectedMineArea())}},{key:"isFROMine",get:function(){return C.ZA.isFroMine(this.mineStateService.getSelectedMineArea())}},{key:"predictionsWidgetAvailable",get:function(){return!this.isFROMine&&!this.isCoalSeam}},{key:"onConfirmClick",value:function(){var o=this;this.data.updateStatus(),(this.isCoalSeam?this.plannedBenchesApiService.removeCoalSeamFileFromTree(this.data.fileNode.uuid):this.plannedBenchesApiService.removeFileFromTree(this.data.fileNode.uuid)).pipe((0,ft.P)()).subscribe(function(){o.data.updateTree()}),this.dialogRef.close(!0)}}]),r}();return a.\u0275fac=function(n){return new(n||a)(e.Y36(T.WI),e.Y36(T.so),e.Y36(v.I),e.Y36(S.Hj))},a.\u0275cmp=e.Xpm({type:a,selectors:[["dabo-file-delete-dialog"]],decls:15,vars:4,consts:[[1,"fill-remaining-space"],["mat-dialog-close","",1,"icon","icon-close"],["class","modal-content-title",4,"ngIf"],["class","modal-content__warning",4,"ngIf"],["fxLayoutAlign","end center","fxLayoutGap","12px"],["mat-button","","mat-dialog-close","","tabindex","-1",1,"modal__btn","btn","btn--secondary"],["mat-button","",1,"modal__btn","btn","btn--primary",3,"click"],[1,"modal-content-title"],[1,"modal-content__warning"]],template:function(n,o){1&n&&(e.TgZ(0,"mat-toolbar")(1,"mat-toolbar-row")(2,"h2"),e._uU(3,"Deleting"),e.qZA(),e._UZ(4,"div",0)(5,"span",1),e.qZA()(),e.TgZ(6,"mat-dialog-content"),e.YNc(7,ht,3,6,"h3",2),e.YNc(8,vt,2,3,"h3",2),e.YNc(9,_t,2,0,"span",3),e.qZA(),e.TgZ(10,"mat-dialog-actions",4)(11,"button",5),e._uU(12,"Cancel"),e.qZA(),e.TgZ(13,"button",6),e.NdJ("click",function(){return o.onConfirmClick()}),e._uU(14),e.qZA()()),2&n&&(e.xp6(7),e.Q6J("ngIf",o.isCoalSeam&&!o.isHVCMine),e.xp6(1),e.Q6J("ngIf",!o.isCoalSeam),e.xp6(1),e.Q6J("ngIf",o.predictionsWidgetAvailable),e.xp6(5),e.hij(" ",o.predictionsWidgetAvailable?"Delete anyway":"Yes, delete it"," "))},directives:[Z.Ye,Z.rD,T.ZT,T.xY,b.O5,T.H8,h.Wh,h.SQ,F.lW],pipes:[b.rS],styles:["mat-dialog-container[_ngcontent-%COMP%]{width:500px}.mat-dialog-content[_ngcontent-%COMP%]{text-align-last:start}.mat-dialog-content[_ngcontent-%COMP%] > h3[_ngcontent-%COMP%]{text-align:unset}.mat-dialog-actions[_ngcontent-%COMP%]{justify-content:center}.modal__btn[_ngcontent-%COMP%]{width:140px}"]}),a}(),Ct=c(74708);function yt(a,r){1&a&&(e.TgZ(0,"div",7),e._UZ(1,"div",8),e.qZA())}var Pt=function(r){return{"leaf-node__icon--collapsed":r}};function Mt(a,r){if(1&a&&(e.TgZ(0,"button",9)(1,"mat-icon",10),e._uU(2),e.qZA()()),2&a){var n=e.oxw();e.Q6J("disableRipple",!0),e.uIk("aria-label","toggle "+n.node.name),e.xp6(1),e.Q6J("ngClass",e.VKq(4,Pt,!n.treeControl.isExpanded(n.node))),e.xp6(1),e.hij(" ",n.treeControl.isExpanded(n.node)?"expand_more":"chevron_right"," ")}}function Tt(a,r){1&a&&e.GkF(0)}function St(a,r){if(1&a&&(e.ynx(0),e.YNc(1,Tt,1,0,"ng-container",11),e.BQk()),2&a){e.oxw();var n=e.MAs(11);e.xp6(1),e.Q6J("ngTemplateOutlet",n)}}function xt(a,r){1&a&&e.GkF(0)}function Ot(a,r){if(1&a&&(e.ynx(0),e.YNc(1,xt,1,0,"ng-container",11),e.BQk()),2&a){e.oxw();var n=e.MAs(7);e.xp6(1),e.Q6J("ngTemplateOutlet",n)}}function Ft(a,r){1&a&&e.GkF(0)}function Lt(a,r){if(1&a&&(e.ynx(0),e.YNc(1,Ft,1,0,"ng-container",11),e.BQk()),2&a){e.oxw();var n=e.MAs(9);e.xp6(1),e.Q6J("ngTemplateOutlet",n)}}function At(a,r){if(1&a&&(e.TgZ(0,"div",21)(1,"span",22),e._uU(2),e.qZA()()),2&a){var n=e.oxw(2);e.xp6(1),e.Q6J("treeStatus",n.node.status)("baseClass","leaf-node__status")("matTooltipDisabled",!n.isImportError)("matTooltip",n.getFileTooltipErrorMessage()),e.xp6(1),e.Oqu(n.node.statusMessage)}}function kt(a,r){if(1&a){var n=e.EpF();e.TgZ(0,"div",27)(1,"span",28),e.NdJ("click",function(){return e.CHM(n),e.oxw(3).editCoalSeamFile()}),e.qZA()()}}function Bt(a,r){if(1&a){var n=e.EpF();e.TgZ(0,"div",23),e.NdJ("click",function(t){return t.preventDefault()}),e.YNc(1,kt,2,0,"div",24),e.TgZ(2,"div",25)(3,"span",26),e.NdJ("click",function(){return e.CHM(n),e.oxw(2).deleteFile()}),e.qZA()()()}if(2&a){var o=e.oxw(2);e.xp6(1),e.Q6J("ngIf",o.editEnabled)}}var Zt=function(r){return{"leaf-node__checkbox-hidden":r}};function Nt(a,r){if(1&a){var n=e.EpF();e.TgZ(0,"mat-checkbox",12),e.NdJ("change",function(){e.CHM(n);var i=e.oxw();return i.treeLeafItemSelectionToggle.emit(i.node)}),e.TgZ(1,"div",13)(2,"div",14)(3,"div",15)(4,"span",16),e._uU(5),e.qZA(),e.TgZ(6,"span",17,18),e._uU(8),e.qZA()(),e.YNc(9,At,3,5,"div",19),e.qZA(),e.YNc(10,Bt,4,1,"div",20),e.qZA()()}if(2&a){var o=e.MAs(7),l=e.oxw();e.Q6J("disabled",l.isImportError||l.isLoading)("ngClass",e.VKq(10,Zt,l.isImportError||l.isLoading))("checked",l.checklistSelection.isSelected(l.node)&&l.checklistSelection.hasValue()),e.xp6(3),e.Q6J("matTooltipDisabled",l.isTooltipHidden(o,l.node))("matTooltip",l.node.name)("matTooltipPosition","above"),e.xp6(2),e.hij(" ",l.getLabelPrefix()," "),e.xp6(3),e.hij(" ",l.node.name," "),e.xp6(1),e.Q6J("ngIf",l.node.status&&l.node.statusMessage),e.xp6(1),e.Q6J("ngIf",!l.isGrandNode)}}function Dt(a,r){1&a&&e._UZ(0,"span",34)}var Et=function(r){return{"polygon-error":r}};function It(a,r){if(1&a){var n=e.EpF();e.TgZ(0,"mat-checkbox",29),e.NdJ("change",function(){e.CHM(n);var i=e.oxw();return i.treeLeafItemSelectionToggle.emit(i.node)}),e.TgZ(1,"div",30)(2,"div",14)(3,"div",31)(4,"span",16,32),e._uU(6),e.qZA()(),e.YNc(7,Dt,1,0,"span",33),e.qZA()()()}if(2&a){var o=e.MAs(5),l=e.oxw();e.Q6J("disabled",!0)("checked",l.checklistSelection.isSelected(l.node)&&l.checklistSelection.hasValue()),e.xp6(1),e.Q6J("matTooltipDisabled",l.isTooltipHidden(o,l.node))("matTooltip",l.node.name)("matTooltipPosition","above"),e.xp6(2),e.Q6J("ngClass",e.VKq(8,Et,l.isImportError)),e.xp6(3),e.hij(" ",l.node.name," "),e.xp6(1),e.Q6J("ngIf",l.isImportError)}}function wt(a,r){if(1&a&&(e.TgZ(0,"div",13)(1,"div",14)(2,"div",35)(3,"span",17),e._uU(4),e.qZA()()()()),2&a){var n=e.oxw();e.xp6(4),e.hij(" ",n.node.name," ")}}var Rt=function(r,n,o){return{"parent-node":r,"leaf-node__polygon":n,"leaf-node__new":o}},Ut=O.Z.DELETED,Jt=O.Z.PARSING,Yt=O.Z.CALCULATION,Ht=W.A.TOP,Qt=function(){var a=function(){function r(n){(0,P.Z)(this,r),this.dialog=n,this.treeLeafItemSelectionToggle=new e.vpe,this.handleDeleteStatus=new e.vpe,this.handleDelete=new e.vpe}return(0,y.Z)(r,[{key:"editEnabled",get:function(){return this.mine!==H.q.HVC&&this.node.type===N.e.COAL_SEAM}},{key:"isLoading",get:function(){var o=this.node.status;return o&&[Ut,Jt,Yt].includes(o)}},{key:"isGrandNode",get:function(){return!this.node.type}},{key:"isImportError",get:function(){var o=this.node.status;return o&&o.includes("ERROR")}},{key:"isFileNode",get:function(){var o=this.node.type;return o===N.e.POLYGONS||o===N.e.COAL_SEAM}},{key:"isPolygonNode",get:function(){return this.node.type===N.e.POLYGON}},{key:"isTooltipHidden",value:function(o,l){return o.offsetWidth<(l.coalSeamType?l.coalSeamType===Ht?95:90:150)||l.status===O.Z.CALCULATION_ERROR}},{key:"getLabelPrefix",value:function(){var o=this.node,t=o.name,i="";switch(o.coalSeamType){case W.A.TOP:i="Top Coal: ";break;case W.A.BOTTOM:i=t.length>10?"Bot. Coal: ":"Bottom Coal: "}return i}},{key:"editCoalSeamFile",value:function(){return this.filesImportDialogRef=this.dialog.open(ye,{panelClass:["modal-base","modal--file-import-planned-benches"],data:{fileNode:this.node},disableClose:!0}),this.filesImportDialogRef}},{key:"deleteFile",value:function(){var o=this;return this.filesDeleteDialogRef=this.dialog.open(bt,{panelClass:["modal-base","modal--planned-benches-delete"],data:{fileNode:this.node,updateStatus:function(){o.handleDeleteStatus.emit(o.node)},updateTree:function(){o.handleDelete.emit(o.node)}},disableClose:!0}),this.filesDeleteDialogRef}},{key:"getFileTooltipErrorMessage",value:function(){return"Seems the ".concat(this.node.name," file is corrupted. Please upload another file to proceed")}}]),r}();return a.\u0275fac=function(n){return new(n||a)(e.Y36(T.uw))},a.\u0275cmp=e.Xpm({type:a,selectors:[["dabo-files-tree-leaf"]],inputs:{node:"node",mine:"mine",treeControl:"treeControl",checklistSelection:"checklistSelection"},outputs:{treeLeafItemSelectionToggle:"treeLeafItemSelectionToggle",handleDeleteStatus:"handleDeleteStatus",handleDelete:"handleDelete"},decls:12,vars:10,consts:[[1,"leaf-node",3,"ngClass"],["class","base-spinner-wrapper",4,"ngIf"],["class","leaf-node__arrow","mat-icon-button","","matTreeNodeToggle","",3,"disableRipple",4,"ngIf"],[4,"ngIf"],["fileLabel",""],["polygonLabel",""],["label",""],[1,"base-spinner-wrapper"],[1,"spinner"],["mat-icon-button","","matTreeNodeToggle","",1,"leaf-node__arrow",3,"disableRipple"],[1,"mat-icon-rtl-mirror","leaf-node__icon",3,"ngClass"],[4,"ngTemplateOutlet"],[1,"leaf-node__checkbox",3,"disabled","ngClass","checked","change"],["fxLayout","row","fxLayoutAlign","space-between center",1,"leaf-node__label"],["fxLayout","column",1,"label__group"],["matTooltipClass","leaf-node__tooltip",1,"label","label__file-name",3,"matTooltipDisabled","matTooltip","matTooltipPosition"],[1,"font-thin"],[1,"font-normal"],["fileLabelNode",""],["class","label label__file-status",4,"ngIf"],["fxLayout","row","fxLayoutAlign","space-between center",3,"click",4,"ngIf"],[1,"label","label__file-status"],[3,"treeStatus","baseClass","matTooltipDisabled","matTooltip"],["fxLayout","row","fxLayoutAlign","space-between center",3,"click"],["class","leaf-node__edit-seam",4,"ngIf"],[1,"leaf-node__remove-btn"],["mat-button","",1,"icon","icon-close",3,"click"],[1,"leaf-node__edit-seam"],["mat-button","",1,"icon","icon-edit",3,"click"],[1,"leaf-node__checkbox","leaf-node__checkbox-hidden",3,"disabled","checked","change"],["matTooltipClass","leaf-node__tooltip","fxLayout","row","fxLayoutAlign","space-between center",1,"leaf-node__label",3,"matTooltipDisabled","matTooltip","matTooltipPosition"],[1,"label","label__file-name",3,"ngClass"],["polygonNodeLabel",""],["class","icon icon-alert status-icon",4,"ngIf"],[1,"icon","icon-alert","status-icon"],[1,"label","label__file-name"]],template:function(n,o){1&n&&(e.TgZ(0,"div",0),e.YNc(1,yt,2,0,"div",1),e.YNc(2,Mt,3,6,"button",2),e.YNc(3,St,2,1,"ng-container",3),e.YNc(4,Ot,2,1,"ng-container",3),e.YNc(5,Lt,2,1,"ng-container",3),e.qZA(),e.YNc(6,Nt,11,12,"ng-template",null,4,e.W1O),e.YNc(8,It,8,10,"ng-template",null,5,e.W1O),e.YNc(10,wt,5,1,"ng-template",null,6,e.W1O)),2&n&&(e.Q6J("ngClass",e.kEZ(6,Rt,o.isGrandNode,o.isPolygonNode,o.node.status&&!o.isPolygonNode)),e.xp6(1),e.Q6J("ngIf",o.isLoading||!o.isPolygonNode&&o.isImportError),e.xp6(1),e.Q6J("ngIf",o.node.expandable&&!o.isLoading&&!o.isImportError),e.xp6(1),e.Q6J("ngIf",o.isGrandNode),e.xp6(1),e.Q6J("ngIf",o.isFileNode),e.xp6(1),e.Q6J("ngIf",o.isPolygonNode))},directives:[b.mk,I.oO,b.O5,F.lW,A.eu,Y.Hw,b.tP,B.oG,h.xw,h.Wh,w.gM,Ct.g],styles:["[_nghost-%COMP%]{width:100%}.leaf-node[_ngcontent-%COMP%], .leaf-node__status[_ngcontent-%COMP%], .leaf-node__status--deleting[_ngcontent-%COMP%], .leaf-node__status--parsing[_ngcontent-%COMP%], .leaf-node__status--error[_ngcontent-%COMP%], .leaf-node__status--complete[_ngcontent-%COMP%]{display:flex;position:relative;padding-bottom:0;align-items:center;color:#586b7a;line-height:26px}.leaf-node__remove-btn[_ngcontent-%COMP%]{display:none;cursor:pointer}.leaf-node__remove-btn[_ngcontent-%COMP%]   .icon-close[_ngcontent-%COMP%]{height:14px;padding:5px}.leaf-node__remove-btn[_ngcontent-%COMP%]   .icon-close[_ngcontent-%COMP%]:hover{background-color:#e3e4e5}.leaf-node__remove-btn[_ngcontent-%COMP%]   .icon-close[_ngcontent-%COMP%]:active, .leaf-node__remove-btn[_ngcontent-%COMP%]   .icon-close[_ngcontent-%COMP%]:focus{background-color:#d4d6d9}.leaf-node__remove-btn[_ngcontent-%COMP%]   .icon-close[_ngcontent-%COMP%]:active:before, .leaf-node__remove-btn[_ngcontent-%COMP%]   .icon-close[_ngcontent-%COMP%]:focus:before, .leaf-node__remove-btn[_ngcontent-%COMP%]   .icon-close[_ngcontent-%COMP%]:hover:before{opacity:1;color:#0065bd}.leaf-node__edit-seam[_ngcontent-%COMP%]{display:none;cursor:pointer}.leaf-node__edit-seam[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{height:14px;padding:5px}.leaf-node__edit-seam[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]:hover{background-color:#e3e4e5}.leaf-node__edit-seam[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]:active, .leaf-node__edit-seam[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]:focus{background-color:#d4d6d9}.leaf-node__edit-seam[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]:active:before, .leaf-node__edit-seam[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]:focus:before, .leaf-node__edit-seam[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]:hover:before{color:#0065bd}.leaf-node__arrow[_ngcontent-%COMP%]{position:absolute;left:-24px}.leaf-node__new[_ngcontent-%COMP%]{padding-bottom:18px}.leaf-node__polygon[_ngcontent-%COMP%]   .polygon-error[_ngcontent-%COMP%]{color:#c06868}.leaf-node__polygon[_ngcontent-%COMP%]   .icon-alert[_ngcontent-%COMP%]{display:block;line-height:24px}.leaf-node__polygon[_ngcontent-%COMP%]   .icon-alert[_ngcontent-%COMP%]:before{color:#c06868}.leaf-node__label[_ngcontent-%COMP%]{width:100%;cursor:pointer}.leaf-node__label[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:12px;line-height:16px}.leaf-node__label[_ngcontent-%COMP%]   .label__file-name[_ngcontent-%COMP%]{font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:180px}.leaf-node__status[_ngcontent-%COMP%], .leaf-node__status--deleting[_ngcontent-%COMP%], .leaf-node__status--parsing[_ngcontent-%COMP%], .leaf-node__status--error[_ngcontent-%COMP%], .leaf-node__status--complete[_ngcontent-%COMP%]{padding-right:15px}.leaf-node__status--complete[_ngcontent-%COMP%]{color:#39be04;opacity:.75}.leaf-node__status--error[_ngcontent-%COMP%]{color:#ff4545;opacity:.75}.leaf-node__status--parsing[_ngcontent-%COMP%]{color:#00000080;opacity:.75}.leaf-node__status--deleting[_ngcontent-%COMP%]{color:#f16b16;opacity:.75}.leaf-node[_ngcontent-%COMP%]:hover   .leaf-node__remove-btn[_ngcontent-%COMP%], .leaf-node__status[_ngcontent-%COMP%]:hover   .leaf-node__remove-btn[_ngcontent-%COMP%], .leaf-node__status--complete[_ngcontent-%COMP%]:hover   .leaf-node__remove-btn[_ngcontent-%COMP%], .leaf-node__status--error[_ngcontent-%COMP%]:hover   .leaf-node__remove-btn[_ngcontent-%COMP%], .leaf-node__status--parsing[_ngcontent-%COMP%]:hover   .leaf-node__remove-btn[_ngcontent-%COMP%], .leaf-node__status--deleting[_ngcontent-%COMP%]:hover   .leaf-node__remove-btn[_ngcontent-%COMP%], .leaf-node[_ngcontent-%COMP%]:hover   .leaf-node__edit-seam[_ngcontent-%COMP%], .leaf-node__status[_ngcontent-%COMP%]:hover   .leaf-node__edit-seam[_ngcontent-%COMP%], .leaf-node__status--complete[_ngcontent-%COMP%]:hover   .leaf-node__edit-seam[_ngcontent-%COMP%], .leaf-node__status--error[_ngcontent-%COMP%]:hover   .leaf-node__edit-seam[_ngcontent-%COMP%], .leaf-node__status--parsing[_ngcontent-%COMP%]:hover   .leaf-node__edit-seam[_ngcontent-%COMP%], .leaf-node__status--deleting[_ngcontent-%COMP%]:hover   .leaf-node__edit-seam[_ngcontent-%COMP%]{display:flex}.leaf-node__icon[_ngcontent-%COMP%]{color:#586b7a}.leaf-node__icon--collapsed[_ngcontent-%COMP%]{color:#586b7a80}.mat-icon-button[_ngcontent-%COMP%]{width:initial;height:16px;line-height:16px}.mat-icon-button[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%], .mat-icon-button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{line-height:16px}.icon[_ngcontent-%COMP%]{width:12px;height:12px;font-size:12px}.status-icon[_ngcontent-%COMP%]{position:absolute;left:-22px;top:2px}.icon-alert[_ngcontent-%COMP%]{display:none}.label__group[_ngcontent-%COMP%], .label__group__seam--hover[_ngcontent-%COMP%]{min-width:130px;max-width:130px}.label__group__seam--hover[_ngcontent-%COMP%]{min-width:150px;max-width:150px}.label__group[_ngcontent-%COMP%]   .label__file-status[_ngcontent-%COMP%], .label__group__seam--hover[_ngcontent-%COMP%]   .label__file-status[_ngcontent-%COMP%]{position:absolute;bottom:0}.base-spinner-wrapper[_ngcontent-%COMP%]{width:auto;margin-right:8px}.base-spinner-wrapper[_ngcontent-%COMP%]   .spinner[_ngcontent-%COMP%]{margin:auto 0;width:8px;height:8px;border-width:4px}mat-checkbox[_ngcontent-%COMP%]{width:100%;cursor:pointer}[_nghost-%COMP%]     .leaf-node__checkbox-hidden .mat-checkbox-inner-container{display:none}[_nghost-%COMP%]     .mat-checkbox-layout{width:100%;align-items:flex-start}[_nghost-%COMP%]     .mat-checkbox-layout .mat-checkbox-label{width:100%}[_nghost-%COMP%]     .mat-checkbox-disabled .mat-checkbox-label{color:#586b7a}[_nghost-%COMP%]     .mat-checkbox-frame{border:2px solid rgba(0,30,58,.3);border-radius:2px}[_nghost-%COMP%]     .mat-checkbox-ripple{display:none}.parent-node[_ngcontent-%COMP%]{color:#282d32;height:22px}.parent-node[_ngcontent-%COMP%]   .leaf-node__arrow[_ngcontent-%COMP%]{position:static}"]}),a}(),Vt=c(57491);function Wt(a,r){if(1&a){var n=e.EpF();e.TgZ(0,"button",7),e.NdJ("click",function(){return e.CHM(n),e.oxw(2).deselectAll()}),e._uU(1," Deselect All "),e.qZA()}}function $t(a,r){if(1&a){var n=e.EpF();e.TgZ(0,"div",4)(1,"button",5),e.NdJ("click",function(){return e.CHM(n),e.oxw().selectAll()}),e._uU(2," Select All "),e.qZA(),e.YNc(3,Wt,2,0,"button",6),e.qZA()}if(2&a){var o=e.oxw();e.Q6J("ngClass","button-controls"),e.xp6(1),e.Q6J("disabled",!o.getSelectableNodes().length),e.xp6(2),e.Q6J("ngIf",o.checklistSelection.hasValue())}}var Gt=function(r,n){return{complete:r,"node--mining-area":n}};function jt(a,r){if(1&a){var n=e.EpF();e.TgZ(0,"mat-tree-node",10),e.NdJ("click",function(){var s=e.CHM(n).$implicit;return e.oxw(2).selectPolygonOnMap(s)}),e.TgZ(1,"dabo-files-tree-leaf",11),e.NdJ("handleDelete",function(i){return e.CHM(n),e.oxw(2).deleteNestedNode(i)})("handleDeleteStatus",function(i){return e.CHM(n),e.oxw(2).handleDeleteStatus(i)})("treeLeafItemSelectionToggle",function(i){return e.CHM(n),e.oxw(2).treeLeafItemSelectionToggle(i)}),e.qZA()()}if(2&a){var o=r.$implicit,l=e.oxw(2);e.ekj("highlight",l.isPolygonHighlighted(o)),e.Q6J("matTreeNodePaddingIndent",o.level>1?24:16)("ngClass",e.WLB(9,Gt,o.status===l.fileStatuses.SUCCESS&&o.type!==l.treeNodeType.POLYGON,0===o.level)),e.xp6(1),e.Q6J("checklistSelection",l.checklistSelection)("matTooltip",l.getPolygonTooltip(o))("mine",l.selectedMineArea)("node",o)("treeControl",l.treeControl)}}function qt(a,r){if(1&a&&(e.TgZ(0,"mat-tree",8),e.YNc(1,jt,2,12,"mat-tree-node",9),e.qZA()),2&a){var n=e.oxw();e.Q6J("dataSource",n.dataSource)("treeControl",n.treeControl)}}function zt(a,r){1&a&&e._UZ(0,"dabo-no-data-container")}var Kt=function(){var a=function(r){(0,q.Z)(o,r);var n=(0,z.Z)(o);function o(l,t,i,s,d,g){var p;return(0,P.Z)(this,o),(p=n.call(this)).cdr=l,p.wsService=t,p.treeStateService=i,p.patternsService=s,p.plannedBenchesMapService=d,p.inspectorService=g,p.fileStatuses=O.Z,p.treeNodeType=N.e,p.checklistSelection=new Pe.Ov(!0),p.flatNodeMap=new Map,p.nestedNodeMap=new Map,p.transformer=function(u,m){var k=p.nestedNodeMap.get(u)||new mt;return k=Q.mapToFlat(k,u,m),p.flatNodeMap.set(k,u),p.nestedNodeMap.set(u,k),k},p.treeFlattener=new A.JZ(p.transformer,function(u){return u.level},function(u){return u.expandable},function(u){return u.children}),p.treeControl=new ct.C2(function(u){return u.level},function(u){return u.expandable}),p.dataSource=new A.kc(p.treeControl,p.treeFlattener),p}return(0,y.Z)(o,[{key:"mineArea",set:function(t){this.selectedMineArea=t,this.wsService.forceReconnect({url:dt.yh.plannedBenches}),this.flatNodeMap.clear(),this.nestedNodeMap.clear(),this.checklistSelection.clear()}},{key:"ngOnInit",value:function(){var t=this;this.updateTreeOnWS(),this.updatePatternsOnSelectionChange(),this.treeStateService.fileTree$.pipe((0,x.R)(this.destroy$)).subscribe(function(i){t.dataSource.data=i,t.cdr.detectChanges()}),this.inspectorService.panelInfoData$.subscribe(function(i){var s=t.treeControl.dataNodes.find(function(d){return d.uuid===i.uuid});t.updateNestedNode(s,i)}),this.plannedBenchesMapService.highlightedPolygon$.pipe((0,pe.h)(function(i){return i.mapEvent}),(0,x.R)(this.destroy$)).subscribe(function(i){t.highlightedPolygon=i.id,t.cdr.detectChanges()})}},{key:"ngOnDestroy",value:function(){this.wsService.closeConnection(),(0,re.Z)((0,se.Z)(o.prototype),"ngOnDestroy",this).call(this)}},{key:"selectAll",value:function(){var t,i=this.getSelectableNodes();(t=this.checklistSelection).select.apply(t,(0,D.Z)(i)),this.treeControl.expandAll(),this.cdr.detectChanges()}},{key:"deselectAll",value:function(){this.checklistSelection.clear(),this.treeControl.collapseAll(),this.cdr.detectChanges()}},{key:"isPolygonHighlighted",value:function(t){var i=t.uuid;return t.name&&i&&i===this.highlightedPolygon}},{key:"treeLeafItemSelectionToggle",value:function(t){this.checklistSelection.toggle(t);var i=this.treeControl.dataNodes.find(function(s){return s.uuid===t.uuid});i.status&&this.updateNestedNode(i,{status:null,statusMessage:null})}},{key:"handleDeleteStatus",value:function(t){this.checklistSelection.deselect(t),this.updateNestedNode(t,{status:this.fileStatuses.DELETED,statusMessage:"Deleting"})}},{key:"getSelectableNodes",value:function(){return this.treeControl.dataNodes.filter(function(t){return Q.isSelectableNode(t)})}},{key:"deleteNestedNode",value:function(t){var s,i=this;switch(t.level){case 2:s=this.findBenchNode(t);break;case 1:s=this.findMineNode(t);break;default:s=this.dataSource.data}var g,d=this.flatNodeMap.get(s)||this.dataSource.data;switch(t.level){case 2:g=d.children.filter(function(u){return u.status!==i.fileStatuses.DELETED});break;case 1:g=d.children;break;default:g=[]}var p=this.flatNodeMap.get(t);2===t.level&&!g.length||1===t.level&&g.length<=1?this.deleteNestedNode(s):2===t.level?this.treeStateService.deleteItem(d,p):1===t.level?this.treeStateService.deleteBenchItem(d,p):this.treeStateService.deleteRootItem(d,p)}},{key:"selectPolygonOnMap",value:function(t){t.type===N.e.POLYGON&&t.status===O.Z.SUCCESS&&this.checklistSelection.selected.filter(function(d){return d.type===N.e.POLYGONS}).reduce(function(d,g){var p=g.children;return[].concat((0,D.Z)(d),(0,D.Z)(p))},[]).some(function(d){return d.uuid===t.uuid})&&this.plannedBenchesMapService.highlightedPolygon$.next({treeEvent:!0,id:t.uuid})}},{key:"updatePatternsOnSelectionChange",value:function(){var t=this;this.checklistSelection.changed.pipe((0,x.R)(this.destroy$)).subscribe(function(i){var s=Q.groupNodesByType(i.added),d=(0,de.Z)(s,2),g=d[0],p=d[1],u=Q.groupNodesByType(i.removed),m=(0,de.Z)(u,2),R=m[0],k=m[1],f=Q.groupNodesByType(i.source.selected),_=(0,de.Z)(f,2),fe=_[0],ve=g.length||R.length;(p.length||k.length)&&t.plannedBenchesMapService.coalSeamsIds$.next(_[1]),ve&&(t.plannedBenchesMapService.setFilePolygons(i.source.selected),t.patternsService.updateSelectedPolygons(fe),t.highlightedPolygon=null)})}},{key:"updateTreeOnWS",value:function(){var t=this;this.wsService.on().pipe((0,x.R)(this.destroy$)).subscribe(function(i){var s=t.treeControl.dataNodes.find(function(d){return d.uuid===i.uuid});if(!s)return t.createNestedNode(i),void t.expandNestedNode(i);t.updateNestedNode(s,i)})}},{key:"findMineNode",value:function(t){return this.treeControl.dataNodes.find(function(i){return i.name===t.miningArea})}},{key:"findBenchNode",value:function(t){return this.treeControl.dataNodes.find(function(i){return i.name===t.benchLevel&&i.miningArea===t.miningArea})}},{key:"expandNestedNode",value:function(t){var i=this.findMineNode(t),s=this.findBenchNode(t);this.treeControl.expand(i),this.treeControl.expand(s)}},{key:"createNestedNode",value:function(t){var i=this.findMineNode(t),s=this.findBenchNode(t);if(i)if(s){var u=this.flatNodeMap.get(s||i),m=Q.getNodePosition(u,t);(0,Te.isNull)(m)||this.treeStateService.addItem(u,t,m)}else{var g=this.flatNodeMap.get(i);this.treeStateService.addBenchItem(g,t)}else this.treeStateService.addRootItem(this.dataSource.data,t)}},{key:"updateNestedNode",value:function(t,i){var s=this.flatNodeMap.get(t);this.treeStateService.updateItem(s,i)}},{key:"getPolygonTooltip",value:function(t){var u,s=t.statusMessage,d=t.statusDescription;return t.status===O.Z.CALCULATION_ERROR?d?"".concat(s,": ").concat((u=d).charAt(0).toLowerCase()+u.slice(1)):s:null}}]),o}(C.eO);return a.\u0275fac=function(n){return new(n||a)(e.Y36(e.sBO),e.Y36(Me.l),e.Y36(S.bC),e.Y36(S.c5),e.Y36(v.BA),e.Y36(v.CB))},a.\u0275cmp=e.Xpm({type:a,selectors:[["dabo-files-tree"]],inputs:{mineArea:"mineArea"},features:[e._Bn([Me.l]),e.qOj],decls:4,vars:3,consts:[["fxLayout","column",1,"tree-view-wrapper"],["fxLayoutAlign","start center",3,"ngClass",4,"ngIf"],[3,"dataSource","treeControl",4,"ngIf"],[4,"ngIf"],["fxLayoutAlign","start center",3,"ngClass"],["mat-button","",1,"btn","btn--xs","btn--outline",3,"disabled","click"],["class","btn btn--xs btn--outline","mat-button","",3,"click",4,"ngIf"],["mat-button","",1,"btn","btn--xs","btn--outline",3,"click"],[3,"dataSource","treeControl"],["matTreeNodePadding","",3,"highlight","matTreeNodePaddingIndent","ngClass","click",4,"matTreeNodeDef"],["matTreeNodePadding","",3,"matTreeNodePaddingIndent","ngClass","click"],["matTooltipPosition","above",3,"checklistSelection","matTooltip","mine","node","treeControl","handleDelete","handleDeleteStatus","treeLeafItemSelectionToggle"]],template:function(n,o){1&n&&(e.TgZ(0,"div",0),e.YNc(1,$t,4,3,"div",1),e.YNc(2,qt,2,2,"mat-tree",2),e.YNc(3,zt,1,0,"dabo-no-data-container",3),e.qZA()),2&n&&(e.xp6(1),e.Q6J("ngIf",o.dataSource.data.length),e.xp6(1),e.Q6J("ngIf",o.dataSource.data.length),e.xp6(1),e.Q6J("ngIf",!o.dataSource.data.length))},directives:[h.xw,b.O5,h.Wh,b.mk,I.oO,F.lW,A.gi,A.fQ,A.uo,A.ah,Qt,w.gM,Vt.z],styles:[".tree-view-wrapper[_ngcontent-%COMP%]{height:calc(100vh - 116px);overflow-y:scroll;background-color:#f6f7f7;padding-top:12px}.tree-view-wrapper[_ngcontent-%COMP%]   .button-controls[_ngcontent-%COMP%]{background-color:#f6f7f7;margin-bottom:16px;padding-left:20px}.tree-view-wrapper[_ngcontent-%COMP%]   .button-controls[_ngcontent-%COMP%]   .btn--clean-styles[_ngcontent-%COMP%]{font-weight:500;font-size:12px;line-height:16px}.mat-tree[_ngcontent-%COMP%]{background-color:#f6f7f7;cursor:pointer}mat-tree-node[_ngcontent-%COMP%]{min-height:22px;padding:6px 2px}mat-tree-node[_ngcontent-%COMP%]:not(.highlight):hover{background:linear-gradient(0deg,#eeeeee,#eeeeee),#d8e9fb}mat-tree-node.complete[_ngcontent-%COMP%]{background:#ffefd5}mat-tree-node.complete[_ngcontent-%COMP%]:hover{background:#fce4c0}mat-tree-node.node--mining-area[_ngcontent-%COMP%]{padding-left:8px!important}.highlight[_ngcontent-%COMP%]{background-color:#ba6ae04d}"]}),a}(),ee=c(80013),Xt=c(27221),en=c(22868),Se=c(21086),tn=c(80910),nn=c(69898),ge=c(48619),J=c(78369),E=c(40714),xe=c(31419),ue=c(11660),te=function(){function a(){(0,P.Z)(this,a)}return(0,y.Z)(a,null,[{key:"changeFragmentationPercentage",value:function(n,o){n.setPaintProperty("bench-fragmentation","fill-color",{property:o,type:"interval",stops:ue.R.getStopsForMine("averageFragmentation")})}},{key:"drawBenchFragmentation",value:function(n,o,l){a.removeBenchFragmentation(n),n.addSource("bench-fragmentation",{type:"geojson",data:o}),n.addLayer({id:"bench-fragmentation",type:"fill",source:"bench-fragmentation",layout:{visibility:"visible"},paint:{"fill-color":{property:l,type:"interval",stops:ue.R.getStopsForMine("averageFragmentation")}}})}},{key:"removeBenchFragmentation",value:function(n){C.WC.removeLayers(n,["bench-fragmentation"],["bench-fragmentation"])}},{key:"hidePopup",value:function(n,o){n.getCanvas().style.cursor="",o.remove()}},{key:"showPopup",value:function(n,o,l){n.getCanvas().style.cursor="pointer";var t=xe.yue(l.features[0].geometry.coordinates),i=xe.MqI(t);o.setLngLat({lng:i.geometry.coordinates[0],lat:i.geometry.coordinates[1]}).setHTML('\n          <div class="popup-label">Predicted</div>\n          <div class="popup-label">Fragmentation P50:\n            <span class="popup-value">'.concat(l.features[0].properties.fragmentationP50," ").concat(E.Ab.getUnits("fragmentationP50",H.q.HVC),'</span>\n          </div>\n          <div class="popup-label">Recommended</div>\n          <div class="popup-label">Burden x Spacing:\n           <span class="popup-value">').concat(l.features[0].properties.burden," x ").concat(l.features[0].properties.spacing,' m</span>\n          </div>\n          <div class="popup-label">Energy Factor:\n            <span class="popup-value">').concat(l.features[0].properties.energyFactor," kcal/m\xb3</span>\n          </div>\n       ")).addTo(n)}}]),a}(),on=ge.C.MAUVE_SECONDARY,an=ge.C.SHILO,V=function(){function a(){(0,P.Z)(this,a)}return(0,y.Z)(a,null,[{key:"highlightSelectedPolygon",value:function(n,o,l){o&&(a.resetHighlightedPolygonState(n,["polygons-planned-benches"],l),n.setFeatureState({source:l,id:o.id},{selected:!0}))}},{key:"resetHighlightedPolygonState",value:function(n,o,l){n.queryRenderedFeatures(void 0,{layers:o}).forEach(function(t){n.setFeatureState({source:l,id:t.id},{selected:""})})}},{key:"drawPredictionPolygon",value:function(n){C.WC.removeLayers(n,["polygons-planned-benches","polygons-outline"],["polygons-planned-benches"]),n.addSource("polygons-planned-benches",{type:"geojson",data:{type:"FeatureCollection",features:[]},generateId:!1}),n.addLayer({id:"polygons-planned-benches",type:"fill",source:"polygons-planned-benches",paint:{"fill-color":["case",["==",["feature-state","selected"],!0],"rgba(186, 106, 224, 0.3)",["!=",["get","status"],O.Z.CALCULATION_ERROR],"rgba(186, 106, 224, 0.05)","rgba(255, 0, 0, 0.03)"]}}),n.addLayer({id:"polygons-outline",type:"line",source:"polygons-planned-benches",layout:{visibility:"visible"},paint:{"line-color":this.getLineColorExpressionForPolygonOutline(),"line-width":1,"line-offset":-1}})}},{key:"getLineColorExpressionForPolygonOutline",value:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:on;return["case",["!=",["get","status"],O.Z.CALCULATION_ERROR],n,an]}},{key:"drawLabels",value:function(n){C.WC.removeLayers(n,[J.a.POLYGONS_LABEL_PATTERN_ID],["polygons-label"]),n.addSource("polygons-label",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),C.WC.drawPolygonsPatternId(n)}}]),a}(),ne=function(){function a(){(0,P.Z)(this,a)}return(0,y.Z)(a,null,[{key:"drawBenchBlastability",value:function(n){this.removeBenchBlastability(n),n.addSource("bench-blastability",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),n.addLayer({id:"benchBlastability",type:"fill",source:"bench-blastability",layout:{visibility:"none"},paint:{"fill-color":{property:"blastability",type:"interval",stops:ue.R.getStopsForMine("blastability")}}})}},{key:"removeBenchBlastability",value:function(n){C.WC.removeLayers(n,["benchBlastability"],["bench-blastability"])}},{key:"hidePopup",value:function(n,o){n.getCanvas().style.cursor="",o.remove()}},{key:"showPopup",value:function(n,o,l){var t=new b.JJ("en-US").transform(l.features[0].properties.energyFactor);n.getCanvas().style.cursor="pointer",o.setLngLat(l.lngLat).setHTML('\n          <div class="popup-label">Predicted Blastability:\n          <span class="popup-value">'.concat(l.features[0].properties.blastability,'</span>\n          </div>\n          <div class="popup-label">Recommended</div>\n          <div class="popup-label">Burden x Spacing:\n           <span class="popup-value">').concat(l.features[0].properties.burden," x ").concat(l.features[0].properties.spacing,' m</span>\n          </div>\n          <div class="popup-label">Energy Factor:\n            <span class="popup-value">').concat(t," kcal/m\xb3</span>\n          </div>\n       ")).addTo(n)}}]),a}(),ln=c(97740),rn=c(51275),sn=c(40547);function cn(a,r){if(1&a&&(e.TgZ(0,"span",8),e._UZ(1,"hr",9),e._uU(2),e.qZA()),2&a){var n=r.$implicit,o=e.oxw(2);e.xp6(1),e.Q6J("ngClass",o.getLabelStyle(n.className)),e.xp6(1),e.hij(" ",n.value," ")}}function dn(a,r){if(1&a){var n=e.EpF();e.TgZ(0,"div",4)(1,"span",5)(2,"mat-checkbox",6),e.NdJ("change",function(){var s=e.CHM(n).$implicit;return e.oxw().selectionToggle(s)}),e._uU(3),e.qZA(),e.YNc(4,cn,3,2,"span",7),e.qZA()()}if(2&a){var o=r.$implicit,l=e.oxw();e.xp6(2),e.Q6J("checked",l.selection.isSelected(o)),e.xp6(1),e.hij(" ",o.title," "),e.xp6(1),e.Q6J("ngForOf",o.options)}}function pn(a,r){if(1&a){var n=e.EpF();e.TgZ(0,"div",10),e.NdJ("click",function(){var d=e.CHM(n).$implicit;return e.oxw().filterByLegend(d)}),e._UZ(1,"div",11),e.TgZ(2,"div",12),e._uU(3),e.qZA()()}if(2&a){var o=r.$implicit,l=r.index,t=e.oxw();e.ekj("icon-eye-crossed",o.filterActive),e.Q6J("matTooltip",t.legend.showTooltip?t.legend.tooltip[l]:""),e.xp6(1),e.Udp("border-radius",t.legend.dotRadius)("background-color",o.color),e.xp6(2),e.Oqu(o.title)}}var gn=function(){var a=function(){function r(n,o,l){(0,P.Z)(this,r),this.plannedBenchesMapService=n,this.predictedBlastabilityFiltering=o,this.customEventService=l,this.toggleMarker=new e.vpe,this.legend=this.predictedBlastabilityFiltering.legend,this.selection=new Pe.Ov(!0),this.settings=[{title:"Coal Seams",key:"coal_seam",options:[{value:"Top",className:"black"},{value:"Bottom",className:"red"}]},{title:"Predicted Blastability",key:"blastability",options:[]}]}return(0,y.Z)(r,[{key:"ngOnInit",value:function(){ne.drawBenchBlastability(this.map),this.blastabilityAreas=this.plannedBenchesMapService.subscribeOnBlastabilityAreas(this.updateBlastability.bind(this))}},{key:"ngOnDestroy",value:function(){this.blastabilityAreas&&this.blastabilityAreas.unsubscribe(),this.map.getLayer("benchBlastability")&&ne.removeBenchBlastability(this.map),this.map.getLayer("coal-seams")&&(this.map.setLayoutProperty("coal-seams","visibility","none"),this.map.setPaintProperty("polygons-planned-benches","fill-opacity",1),this.map.setPaintProperty("polygons-outline","line-opacity",1)),C.WC.removeLayers(this.map,["preconditionAreas","preconditionAreas-outline"],["preconditionAreas"]),this.legend=this.predictedBlastabilityFiltering.resetFilters()}},{key:"getLabelStyle",value:function(o){return"label__description--".concat(o)}},{key:"selectionToggle",value:function(o){this.selection.toggle(o);var l=this.selection.isSelected(o);switch(o.key){case"coal_seam":return void this.handleCoalSeam(l);case"blastability":return void this.handleBlastability(l)}}},{key:"filterByLegend",value:function(o){this.selection.isSelected(this.settings[1])&&(this.legend=this.predictedBlastabilityFiltering.updateLegend(o),this.applyFilters(),this.sendHideLegendItemEvent(o))}},{key:"applyFilters",value:function(){var o=this.predictedBlastabilityFiltering.getFilterExpressions();this.map.setFilter("benchBlastability",["any"].concat((0,D.Z)(o)))}},{key:"handleCoalSeam",value:function(o){this.map.setLayoutProperty("coal-seams","visibility",o?"visible":"none"),this.map.setPaintProperty("polygons-planned-benches","fill-opacity",o?.5:1),this.map.setPaintProperty("polygons-outline","line-opacity",o?.5:1),this.map.setPaintProperty("benchBlastability","fill-opacity",o?.5:1)}},{key:"handleBlastability",value:function(o){if(o){var l=this.plannedBenchesMapService.getBlastabilityAreasData();this.map.getSource("bench-blastability").setData(l),this.map.moveLayer("coal-seams","benchBlastability")}else this.legend=this.predictedBlastabilityFiltering.resetFilters(),this.applyFilters();this.map.setLayoutProperty("benchBlastability","visibility",o?"visible":"none"),this.toggleMarker.emit()}},{key:"updateBlastability",value:function(){if(this.map.getLayer("benchBlastability")){var o=this.plannedBenchesMapService.getBlastabilityAreasData();this.map.getSource("bench-blastability").setData(o)}}},{key:"sendHideLegendItemEvent",value:function(o){o.filterActive||this.customEventService.event(K.R.HIDE_LEGEND_ITEM,{color_map_name:X.K.PLANNED_BENCHES,legend_item_name:o.title})}}]),r}();return a.\u0275fac=function(n){return new(n||a)(e.Y36(sn.B),e.Y36(v.eB),e.Y36(S.qL))},a.\u0275cmp=e.Xpm({type:a,selectors:[["dabo-map-legend-planned-benches"]],inputs:{map:"map"},outputs:{toggleMarker:"toggleMarker"},decls:4,vars:2,consts:[["fxFlex","",1,"planned-benches__legend"],["class","legend__controls","fxLayout","row","fxLayoutAlign","stretch center",4,"ngFor","ngForOf"],["fxLayout","row",1,"legend","legend--horizontal","mt-8"],["fxLayout","column","class","legend-item",3,"matTooltip","icon-eye-crossed","click",4,"ngFor","ngForOf"],["fxLayout","row","fxLayoutAlign","stretch center",1,"legend__controls"],["fxLayout","row",1,"legend__controls__checkbox"],[3,"checked","change"],["class","legend__controls__radio--value label",4,"ngFor","ngForOf"],[1,"legend__controls__radio--value","label"],[1,"label__description",3,"ngClass"],["fxLayout","column",1,"legend-item",3,"matTooltip","click"],[1,"legend-dot"],[1,"legend-value"]],template:function(n,o){1&n&&(e.TgZ(0,"div",0),e.YNc(1,dn,5,3,"div",1),e.TgZ(2,"div",2),e.YNc(3,pn,4,8,"div",3),e.qZA()()),2&n&&(e.xp6(1),e.Q6J("ngForOf",o.settings),e.xp6(2),e.Q6J("ngForOf",o.legend.colorStops))},directives:[h.yH,b.sg,h.xw,h.Wh,B.oG,b.mk,I.oO,w.gM],styles:[".planned-benches__legend[_ngcontent-%COMP%]{background-color:#ffffffe6;border-radius:4px;padding:9px}.legend__controls[_ngcontent-%COMP%]{padding-top:4px}.legend__controls__radio--value[_ngcontent-%COMP%]{display:flex;align-items:center}.legend__bins[_ngcontent-%COMP%]{padding-left:8px}.legend-item[_ngcontent-%COMP%]{width:22px}.legend-item[_ngcontent-%COMP%]:hover{cursor:pointer}.legend-item[_ngcontent-%COMP%]   .legend-dot[_ngcontent-%COMP%]{margin-bottom:5px}.label[_ngcontent-%COMP%]:not(:last-child){margin-right:8px;margin-left:8px}.label__description[_ngcontent-%COMP%]{width:10px;height:2px;border:0;margin:0 4px 0 0}.label__description--red[_ngcontent-%COMP%]{background-color:#f25050}.label__description--black[_ngcontent-%COMP%]{background-color:#000}"]}),a}();function un(a,r){1&a&&e._UZ(0,"mat-progress-bar",6)}function mn(a,r){if(1&a&&e._UZ(0,"dabo-coordinates-bar",7),2&a){var n=e.oxw();e.Q6J("map",n.map)}}function fn(a,r){if(1&a){var n=e.EpF();e.TgZ(0,"div",21),e.NdJ("click",function(){var d=e.CHM(n).$implicit;return e.oxw(3).filterByLegend(d)}),e._UZ(1,"div",22),e.TgZ(2,"div",23),e._uU(3),e.qZA()()}if(2&a){var o=r.$implicit,l=r.index,t=e.oxw(3);e.Udp("width",t.maxWidthOfLegendItem,"px"),e.ekj("icon-eye-crossed",o.filterActive),e.Q6J("matTooltip",t.legend.showTooltip?t.legend.tooltip[l]:""),e.xp6(1),e.Udp("border-radius",t.legend.dotRadius)("background-color",o.color),e.xp6(2),e.Oqu(o.title)}}function hn(a,r){if(1&a){var n=e.EpF();e.TgZ(0,"mgl-control",11)(1,"div",12)(2,"div",13)(3,"div",14)(4,"mat-checkbox",15),e.NdJ("change",function(t){return e.CHM(n),e.oxw(2).togglePreconditionAreas(t)}),e._uU(5," Preconditioned Areas "),e.qZA()(),e._UZ(6,"div",16),e.qZA(),e.TgZ(7,"div",17)(8,"div",14)(9,"mat-checkbox",18),e.NdJ("change",function(t){return e.CHM(n),e.oxw(2).toggleFragmentation(t)}),e._uU(10," Predicted Fragmentation P50 "),e.qZA()()(),e.TgZ(11,"div",19),e.YNc(12,fn,4,10,"div",20),e.qZA()()()}if(2&a){var o=e.oxw(2);e.xp6(4),e.Q6J("checked",!0),e.xp6(8),e.Q6J("ngForOf",o.legend.colorStops)}}function vn(a,r){if(1&a){var n=e.EpF();e.TgZ(0,"mgl-control",11)(1,"dabo-map-legend-planned-benches",24),e.NdJ("toggleMarker",function(t){return e.CHM(n),e.oxw(2).toggleMarker(t)}),e.qZA()()}if(2&a){var o=e.oxw(2);e.xp6(1),e.Q6J("map",o.map)}}var Oe=function(){return[13,39]},oe=function(r){return[r]},Fe=function(){return[6,18]},Le=function(){return[13,6,39,18]},Ae=function(r,n,o){return{stretchX:r,stretchY:n,content:o}};function _n(a,r){if(1&a&&(e.ynx(0),e._UZ(1,"mgl-image",8)(2,"mgl-image",9),e.YNc(3,hn,13,2,"mgl-control",10),e.YNc(4,vn,2,1,"mgl-control",10),e.BQk()),2&a){var n=e.oxw();e.xp6(1),e.Q6J("options",e.kEZ(11,Ae,e.VKq(5,oe,e.DdM(4,Oe)),e.VKq(8,oe,e.DdM(7,Fe)),e.DdM(10,Le))),e.xp6(1),e.Q6J("options",e.kEZ(22,Ae,e.VKq(16,oe,e.DdM(15,Oe)),e.VKq(19,oe,e.DdM(18,Fe)),e.DdM(21,Le))),e.xp6(1),e.Q6J("ngIf",n.isHVC),e.xp6(1),e.Q6J("ngIf",!n.isHVC)}}var bn=function(){return[12]},me=function(r,n){return[r,n]},Cn=function(r){return[r,49.750330560335236]},yn=function(){return[180,84]},Pn=ge.C.BLACK,Mn=function(){var a=function(r){(0,q.Z)(o,r);var n=(0,z.Z)(o);function o(l,t,i,s,d,g,p,u,m,R,k){var f;return(0,P.Z)(this,o),(f=n.call(this)).mapStateService=l,f.patternsService=t,f.plannedBenchesApiService=i,f.fragmentationDataService=s,f.inspectorService=d,f.predictionResultsService=g,f.cdr=p,f.plannedBenchesResultsService=u,f.predictedFragmentationFilteringService=m,f.plannedBenchesMapService=R,f.customEventService=k,f.togglePanel=new e.vpe,f.legend=f.predictedFragmentationFilteringService.legend,f.loading=!1,f.inspectorDataLoading=!1,f.popup=new nn.Popup({closeButton:!1}),f.mapTooltipHelper=new E.qi,f.isFragmentationActive=!1,f.isPreconditionAreasActive=!0,f.isMarkerPresent=!0,f.selectedFragmentation="fragmentationP50",f.inspectorService.panelInfoData$.subscribe(function(_){f.plannedBenchesMapService.updatePolygon(_.uuid,{polygonName:_.polygonName})}),f}return(0,y.Z)(o,[{key:"closePanel",set:function(t){this.map&&E.WO.checkLayers(["polygons-planned-benches"],this.map)&&!t&&V.resetHighlightedPolygonState(this.map,["polygons-planned-benches"],"polygons-planned-benches")}},{key:"isHVC",get:function(){return C.ZA.isHVC(this.mineArea)}},{key:"isCDA",get:function(){return C.ZA.isCDA(this.mineArea)}},{key:"ngOnInit",value:function(){var t=this;this.setMaxWidthOfLegendItem(),this.plannedBenchesMapService.highlightedPolygon$.pipe((0,pe.h)(function(i){return i.treeEvent}),(0,x.R)(this.destroy$)).subscribe(function(i){return t.selectPolygonOnMap(i.id)})}},{key:"ngOnDestroy",value:function(){(0,re.Z)((0,se.Z)(o.prototype),"ngOnDestroy",this).call(this),this.plannedBenchesMapService.polygonData$.next({type:"FeatureCollection",features:[]}),this.fragmentationDataService.setFragmentationData({}),this.plannedBenchesMapService.setPreconditionAreas({})}},{key:"toggleMarker",value:function(t){this.isMarkerPresent=t||!this.isMarkerPresent,this.map.setLayoutProperty(J.a.POLYGONS_LABEL_PATTERN_ID,"visibility",this.isMarkerPresent?"visible":"none")}},{key:"onMapLoad",value:function(t){var i=this;this.map=t,C.WC.addControls(this.map,{nav:"bottom-right",attributionControl:"bottom-right"}),["click","touchend"].forEach(function(s){i.map.on(s,"polygons-planned-benches",function(d){var g=i.map.queryRenderedFeatures(d.point,{layers:["polygons-planned-benches"]});o.hasCalculationError(g[0].properties)||(i.showBenchInfo(C.WC.patternInfoParser(g[0],"center")),i.cdr.detectChanges())})}),["mousemove"].forEach(function(s){i.addLayersHoverEvent(s)}),["mouseleave"].forEach(function(s){i.removeLayersHoverEvent(s)}),V.drawPredictionPolygon(this.map),V.drawLabels(this.map),C.WC.drawCoalSeams(this.map),E.w2.addLayers(this.map),this.inspectorService.listenLoading$().pipe((0,x.R)(this.destroy$)).subscribe(function(s){i.inspectorDataLoading=s,i.cdr.detectChanges()}),this.selectedBenchesData().subscribe(function(s){s&&i.mapStateService.rearrangeMapBordersToLoadedPolygons$.next(!0),i.loading=!1,i.cdr.detectChanges()}),this.plannedBenchesMapService.preconditionAreasChanges$().pipe((0,ee.b)(500),(0,x.R)(this.destroy$)).subscribe(function(){i.togglePreconditionAreasDisplay()}),this.fragmentationDataService.fragmentationData$.pipe((0,ee.b)(500),(0,x.R)(this.destroy$)).subscribe(function(){i.toggleFragmentationVisualization()}),this.mapStateService.rearrangeMapBordersToLoadedPolygons$.pipe((0,ee.b)(300),(0,x.R)(this.destroy$)).subscribe(function(s){var d=i.plannedBenchesMapService.polygonData$.getValue();d.features.length||(i.isPreconditionAreasActive=!0),s&&i.map&&d&&C.WC.RearrangeMapBordersToLoadedPolygons(i.map,d)}),this.plannedBenchesMapService.polygonData$.pipe((0,pe.h)(function(s){return!!s}),(0,x.R)(this.destroy$)).subscribe(function(s){i.map.getSource("polygons-planned-benches").setData(s);var g=C.WC.getPolygonLabels(s,["polygonName"]);i.map.getSource("polygons-label").setData(g)}),this.plannedBenchesMapService.coalSeamsIds$.pipe((0,ce.w)(function(s){return i.toggleCoalSeams(s)}),(0,Xt.K)(function(){return i.loading=!1,(0,Se.of)()}),(0,x.R)(this.destroy$)).subscribe(function(s){(0,Te.isEmpty)(s)||(i.loading=!1,i.map.getSource("coal-seams").setData(s),i.cdr.markForCheck())})}},{key:"filterByLegend",value:function(t){this.isFragmentationActive&&(this.legend=this.predictedFragmentationFilteringService.updateLegend(t),this.applyLegendFilters(),this.sendHideLegendItemEvent(t))}},{key:"togglePreconditionAreasDisplay",value:function(){var t;if(E.w2.hide(this.map),this.isPreconditionAreasActive){var i=this.plannedBenchesMapService.getPreconditionAreaData();null===(t=this.map.getSource("preconditionAreas"))||void 0===t||t.setData(i),E.w2.show(this.map),this.map.getLayer(J.a.POLYGONS_LABEL_PATTERN_ID)&&this.map.moveLayer(J.a.POLYGONS_LABEL_PATTERN_ID)}}},{key:"toggleFragmentationVisualization",value:function(){if(E.WO.checkLayers(["polygons-outline"],this.map))if(this.isFragmentationActive){var t=this.fragmentationDataService.getFragmentationData();this.showFragmentation(t),this.applyLegendFilters()}else this.hideFragmentation(),this.legend=this.predictedFragmentationFilteringService.resetFilters()}},{key:"isReloadNeeded",value:function(t){var i=this;return t.some(function(s){return i.previousSelected.has(s)})&&this.previousSelected.size>=t.length}},{key:"selectedBenchesData",value:function(){var t=this;return this.patternsService.selectedPolygons$.pipe((0,ee.b)(400),(0,ce.w)(function(i){var s=Array.from(i),d=t.isReloadNeeded(s);return t.togglePanel.emit({event:!1}),(0,tn.s)(function(){return d},t.predictionResultsService.removeUnselectedIdsData(s,t.map),t.updateData(s))}),(0,en.b)(function(i){t.previousSelected=new Set(Array.from(t.patternsService.selectedPolygons$.getValue())),i.polygonsGeojson&&t.plannedBenchesMapService.polygonData$.next(i.polygonsGeojson),i.fragmentationGeojson&&t.fragmentationDataService.setFragmentationData(i.fragmentationGeojson),i.preconditionAreasGeojson&&t.plannedBenchesMapService.setPreconditionAreas(i.preconditionAreasGeojson),i.blastabilityGeojson&&t.plannedBenchesMapService.setBlastabilityAreas(i.blastabilityGeojson)}),(0,x.R)(this.destroy$))}},{key:"updateData",value:function(t){return this.loading=!0,this.cdr.markForCheck(),t.length?this.plannedBenchesApiService.getPredictedData(t):(this.loading=!1,this.previousSelected=new Set,this.isFragmentationActive=!1,this.toggleMarker(!0),(0,Se.of)({polygonsGeojson:{type:"FeatureCollection",features:[]},fragmentationGeojson:{},blastabilityGeojson:{}}))}},{key:"showBenchInfo",value:function(t){V.highlightSelectedPolygon(this.map,t,"polygons-planned-benches"),this.togglePanel.emit({event:!0,data:t.properties}),this.plannedBenchesMapService.highlightedPolygon$.next({mapEvent:!0,id:t.properties.uuid})}},{key:"toggleFragmentation",value:function(t){this.isFragmentationActive=t.checked,this.toggleMarker(),this.toggleFragmentationVisualization()}},{key:"togglePreconditionAreas",value:function(t){this.isPreconditionAreasActive=t.checked,this.togglePreconditionAreasDisplay()}},{key:"addLayersHoverEvent",value:function(t){var i=this;this.map.on(t,"bench-fragmentation",function(s){te.showPopup(i.map,i.popup,s)}),this.map.on(t,"benchBlastability",function(s){ne.showPopup(i.map,i.popup,s)}),this.map.on(t,"coal-seams",function(s){i.mapTooltipHelper.showPopup(i.map,i.popup,s)}),this.map.on(t,J.a.POLYGONS_LABEL_PATTERN_ID,function(s){var d=i.map.queryRenderedFeatures(s.point,{layers:[J.a.POLYGONS_LABEL_PATTERN_ID]});o.hasCalculationError(d[0].properties)&&(i.map.getCanvas().style.cursor="not-allowed")})}},{key:"applyLegendFilters",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectedFragmentation,i=this.predictedFragmentationFilteringService.getFilterExpressions(t);this.map.setFilter("bench-fragmentation",["any"].concat((0,D.Z)(i)))}},{key:"removeLayersHoverEvent",value:function(t){var i=this;this.map.on(t,"bench-fragmentation",function(){te.hidePopup(i.map,i.popup)}),this.map.on(t,"benchBlastability",function(){ne.hidePopup(i.map,i.popup)}),this.map.on(t,"coal-seams",function(){i.mapTooltipHelper.hidePopup(i.map,i.popup)}),this.map.on(t,J.a.POLYGONS_LABEL_PATTERN_ID,function(){i.map.getCanvas().style.cursor=""})}},{key:"setMaxWidthOfLegendItem",value:function(){this.maxWidthOfLegendItem=7*this.legend.colorStops.reduce(function(i,s){return Math.max(s.title.length,i)},0)}},{key:"hideFragmentation",value:function(){E.WO.changePaintValue(this.map,"polygons-outline","line-color",V.getLineColorExpressionForPolygonOutline()),te.removeBenchFragmentation(this.map)}},{key:"showFragmentation",value:function(t){E.WO.changePaintValue(this.map,"polygons-outline","line-color",V.getLineColorExpressionForPolygonOutline(Pn)),te.drawBenchFragmentation(this.map,t,this.selectedFragmentation),this.map.getLayer("preconditionAreas")&&this.map.moveLayer("bench-fragmentation","preconditionAreas-outline")}},{key:"toggleCoalSeams",value:function(t){var i=t;return t.length<this.selectedCoalSeamsSize?(this.selectedCoalSeamsSize=t.length,this.plannedBenchesResultsService.removeUnselectedIdsData(i,this.map,N.e.COAL_SEAM)):(this.loading=!0,this.selectedCoalSeamsSize=t.length,this.plannedBenchesApiService.getCoalSeams(i))}},{key:"selectPolygonOnMap",value:function(t){if(this.map&&t){var s=this.map.getSource("polygons-planned-benches")._data.features.find(function(d){return d.properties.uuid===t});s&&(this.showBenchInfo(s),this.mapStateService.rearrangeMapBordersToLoadedPolygons$.next(!0))}}},{key:"sendHideLegendItemEvent",value:function(t){t.filterActive||this.customEventService.event(K.R.HIDE_LEGEND_ITEM,{color_map_name:X.K.PLANNED_BENCHES,legend_item_name:t.title})}}],[{key:"hasCalculationError",value:function(t){return t.status&&t.status===O.Z.CALCULATION_ERROR}}]),o}(C.eO);return a.\u0275fac=function(n){return new(n||a)(e.Y36(S.I3),e.Y36(S.c5),e.Y36(v.I),e.Y36(v.FZ),e.Y36(v.CB),e.Y36(v.br),e.Y36(e.sBO),e.Y36(v.br),e.Y36(v.Zk),e.Y36(v.BA),e.Y36(S.qL))},a.\u0275cmp=e.Xpm({type:a,selectors:[["dabo-map-planned-benches"]],inputs:{closePanel:"closePanel",mineArea:"mineArea"},outputs:{togglePanel:"togglePanel"},features:[e.qOj],decls:8,vars:24,consts:[["color","primary","mode","indeterminate",4,"ngIf"],["daboKeydownEscape","",3,"zoom","center","maxBounds","preserveDrawingBuffer","mapLoad"],["position","top-right"],[3,"map",4,"ngIf"],["position","bottom-right"],[4,"ngIf"],["color","primary","mode","indeterminate"],[3,"map"],["id","db_label_black","url","assets/images/db_label_52x24_blck.png",3,"options"],["id","db_label_red","url","assets/images/db_label_52x24_red.png",3,"options"],["position","bottom-left",4,"ngIf"],["position","bottom-left"],["fxFlex","",1,"planned-benches__legend"],["fxLayout","row","fxLayoutAlign","stretch center",1,"legend__controls"],[1,"legend__controls__checkbox"],[3,"checked","change"],[1,"planned-benches-legend-image"],["fxLayout","row",1,"legend__controls","mt-8"],[3,"change"],["fxLayout","row",1,"legend","legend--horizontal","mt-8"],["fxLayout","column","class","legend-item",3,"width","matTooltip","icon-eye-crossed","click",4,"ngFor","ngForOf"],["fxLayout","column",1,"legend-item",3,"matTooltip","click"],[1,"legend-dot"],[1,"legend-value"],[3,"map","toggleMarker"]],template:function(n,o){1&n&&(e.YNc(0,un,1,0,"mat-progress-bar",0),e.TgZ(1,"mgl-map",1),e.NdJ("mapLoad",function(t){return o.onMapLoad(t)}),e.TgZ(2,"mgl-control",2),e.YNc(3,mn,1,1,"dabo-coordinates-bar",3),e.qZA(),e.TgZ(4,"mgl-control",4),e._UZ(5,"dabo-map-fullscreen-button"),e.qZA(),e.YNc(6,_n,5,26,"ng-container",5),e.ALo(7,"async"),e.qZA()),2&n&&(e.Q6J("ngIf",o.loading||o.inspectorDataLoading),e.xp6(1),e.Akn("mapbox://styles/torbadesign/ck85z0yhv0moz1iqc3usneq0u?optimize=true"),e.Q6J("zoom",e.DdM(11,bn))("center",o.isCDA?e.WLB(12,me,-71.10252,-30.25389):e.VKq(15,Cn,-114.82821338244763))("maxBounds",e.WLB(21,me,e.WLB(17,me,-180,-80),e.DdM(20,yn)))("preserveDrawingBuffer",!0),e.xp6(2),e.Q6J("ngIf",o.map),e.xp6(3),e.Q6J("ngIf",e.lcZ(7,9,o.plannedBenchesMapService.polygonData$).features.length>0))},directives:[b.O5,U.pW,L.Gd,be.h,L.Fr,ln.j,rn.d,L.cu,h.yH,h.xw,h.Wh,B.oG,b.sg,w.gM,gn],pipes:[b.Ov],styles:["[_nghost-%COMP%]{width:100%;height:100%}mgl-map[_ngcontent-%COMP%]{width:100%;height:100%}mgl-map[_ngcontent-%COMP%]     .mapboxgl-popup-anchor-top .mapboxgl-popup-tip, mgl-map[_ngcontent-%COMP%]     .mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip, mgl-map[_ngcontent-%COMP%]     .mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{border-bottom-color:#282d32}mgl-map[_ngcontent-%COMP%]     .mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip, mgl-map[_ngcontent-%COMP%]     .mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip, mgl-map[_ngcontent-%COMP%]     .mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{border-top-color:#282d32}mgl-map[_ngcontent-%COMP%]     .mapboxgl-popup-anchor-left .mapboxgl-popup-tip{border-right-color:#282d32}mgl-map[_ngcontent-%COMP%]     .mapboxgl-popup-anchor-right .mapboxgl-popup-tip{border-left-color:#282d32}mgl-map[_ngcontent-%COMP%]     .mapboxgl-popup-content{background-color:#282d32;border:1px solid rgba(166,171,180,.25);box-sizing:border-box;border-radius:4px;text-align:left}mgl-map[_ngcontent-%COMP%]     .mapboxgl-popup-content>.popup-label{color:#939698}mgl-map[_ngcontent-%COMP%]     .mapboxgl-popup-content>.popup-label>.popup-value{color:#fff}.mat-progress-bar[_ngcontent-%COMP%]{position:absolute;top:0;width:100%;height:3px;z-index:100}.mapboxgl-ctrl[_ngcontent-%COMP%]{width:300px;height:200px;background-color:#2b9800}.planned-benches__legend[_ngcontent-%COMP%]{width:auto;background-color:#ffffffe6;border-radius:4px;padding:9px}.planned-benches-legend-image[_ngcontent-%COMP%]{margin-left:11px;height:16px;width:36px;background:url(/assets/images/6pxDark.png) repeat;border:.5px solid rgba(0,0,0,.5)}.legend-item[_ngcontent-%COMP%]:hover{cursor:pointer}.legend-item[_ngcontent-%COMP%]   .legend-dot[_ngcontent-%COMP%]{margin-bottom:5px}.legend__controls__radio[_ngcontent-%COMP%]   mat-radio-button[_ngcontent-%COMP%]{margin-left:8px}"]}),a}(),Tn=c(1400),Sn=function(r){return{disable:r}},xn=function(r){return{opened:r}},Fn=[{path:"",component:function(){var a=function(r){(0,q.Z)(o,r);var n=(0,z.Z)(o);function o(l,t,i,s,d,g,p,u,m,R,k,f){var _;return(0,P.Z)(this,o),(_=n.call(this)).cdr=l,_.dialog=t,_.plannedBenchesApiService=i,_.mineStateService=s,_.treeService=d,_.titleService=g,_.patternsService=p,_.plannedBenchesMapService=u,_.localizationLocalService=m,_.pagePermissionService=R,_.router=k,_.customEventService=f,_.isPanelOpened=!1,_}return(0,y.Z)(o,[{key:"ngOnInit",value:function(){var t=this;this.titleService.setTitle("planned-benches"),this.onMineChange().subscribe(function(){t.isPanelOpened=!1,t.plannedBenchesApiService.updateTree(t.destroy$),t.customEventService.event(K.R.DEFAULT_STATE_COLLECTOR,{page_url:t.router.url}),t.cdr.detectChanges()})}},{key:"ngOnDestroy",value:function(){(0,re.Z)((0,se.Z)(o.prototype),"ngOnDestroy",this).call(this)}},{key:"closePanel",value:function(){this.isPanelOpened=!1,this.plannedBenchesMapService.highlightedPolygon$.next({mapEvent:!0,id:null}),this.cdr.detectChanges()}},{key:"onMineChange",value:function(){var t=this;return this.mineStateService.selectedMineArea$.pipe((0,Ne.x)(),(0,ce.w)(function(i){var s="".concat(t.localizationLocalService.translateText("spinner.loading_tree1")," ").concat(i.value.toUpperCase()," ").concat(t.localizationLocalService.translateText("spinner.loading_tree2"));return t.patternsService.selectedPolygons$.getValue().clear(),t.patternsService.selectedPolygons$.next(new Set),t.patternsService.selectedElevations$.next(new Set),t.mineArea=i.value,t.treeService.getTree(i.value,s)}),(0,x.R)(this.destroy$))}},{key:"openImportDialog",value:function(){return this.filesImportDialogRef=this.dialog.open(ye,{panelClass:["modal-base","modal--file-import-planned-benches"],disableClose:!0}),this.filesImportDialogRef}},{key:"togglePanel",value:function(t){var i=t.data;this.isPanelOpened=t.event&&i&&i.status!==O.Z.CALCULATION_ERROR,this.panelInfo={type:it.K.PREDICTION,polygonData:i},this.cdr.detectChanges()}},{key:"isDisabled",get:function(){return!this.pagePermissionService.canAccess(X.K.PLANNED_BENCHES)}}]),o}(C.eO);return a.\u0275fac=function(n){return new(n||a)(e.Y36(e.sBO),e.Y36(T.uw),e.Y36(v.I),e.Y36(S.Hj),e.Y36(S.yU),e.Y36(S.yD),e.Y36(S.c5),e.Y36(v.BA),e.Y36(lt.bM),e.Y36(S.GO),e.Y36(le.F0),e.Y36(S.qL))},a.\u0275cmp=e.Xpm({type:a,selectors:[["dabo-planned-benches"]],features:[e._Bn([{provide:ie.Hn,useValue:{scope:"planned-benches",alias:"plannedBenchesTranslation"}}]),e.qOj],decls:14,vars:14,consts:[["fxFlex","268px",1,"planned-benches__sidebar"],["fxLayoutAlign","center center"],["transloco","title.planned-benches","daboIsOutOfBound","",1,"page-title","page-title--basic",3,"matTooltip","matTooltipPosition"],["tooltipContent","innerText"],[1,"fill-remaining-space"],["mat-button","",1,"btn-import","btn--fullwidth",3,"disabled","click"],[1,"icon","icon-plus",3,"ngClass"],["transloco","plannedBenchesTranslation.import_new_file"],[3,"mineArea"],["fxFlex","100%","id","map-container"],[3,"mineArea","closePanel","togglePanel"],[3,"panelInfo","isReportsPage","ngClass","closeMapPanel"]],template:function(n,o){if(1&n&&(e.TgZ(0,"div",0)(1,"mat-toolbar",1)(2,"mat-toolbar-row"),e._UZ(3,"dabo-mine-switcher")(4,"span",2,3)(6,"span",4),e.qZA()(),e.TgZ(7,"button",5),e.NdJ("click",function(){return o.openImportDialog()}),e._UZ(8,"span",6)(9,"span",7),e.qZA(),e._UZ(10,"dabo-files-tree",8),e.qZA(),e.TgZ(11,"div",9)(12,"dabo-map-planned-benches",10),e.NdJ("togglePanel",function(i){return o.togglePanel(i)}),e.qZA(),e.TgZ(13,"dabo-map-panel",11),e.NdJ("closeMapPanel",function(){return o.closePanel()}),e.qZA()()),2&n){var l=e.MAs(5);e.xp6(4),e.Q6J("matTooltip",l.innerText)("matTooltipPosition","right"),e.xp6(3),e.Q6J("disabled",o.isDisabled),e.xp6(1),e.Q6J("ngClass",e.VKq(10,Sn,o.isDisabled)),e.xp6(2),e.Q6J("mineArea",o.mineArea),e.xp6(2),e.Q6J("mineArea",o.mineArea)("closePanel",o.isPanelOpened),e.xp6(1),e.Q6J("panelInfo",o.panelInfo)("isReportsPage",!1)("ngClass",e.VKq(12,xn,o.isPanelOpened))}},directives:[h.yH,Z.Ye,h.Wh,Z.rD,rt.p,ie.KI,st.J,w.gM,F.lW,b.mk,I.oO,Kt,Mn,Tn.w],styles:["[_nghost-%COMP%]{width:100%;position:relative}.planned-benches__sidebar[_ngcontent-%COMP%]{max-width:-moz-fit-content;max-width:fit-content}.btn-import[_ngcontent-%COMP%]{color:#1f8ff7bf;text-align:left;background-color:#e6f3ff;line-height:48px}.btn-import[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{margin-right:10px}.btn-import[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]:before{color:#1f8ff7}.btn-import[_ngcontent-%COMP%]   .icon.disable[_ngcontent-%COMP%]:before{color:#b2d1eb}.btn-import[_ngcontent-%COMP%]:hover:not([disabled]){color:#0165bdbf;background-color:#cbe7ff}.btn-import[_ngcontent-%COMP%]:hover:not([disabled])   .icon[_ngcontent-%COMP%]:before{color:#0165bd}mat-toolbar[_ngcontent-%COMP%]{height:64px}"]}),a}()},{path:"**",redirectTo:""}],Ln=function(){var a=(0,y.Z)(function r(){(0,P.Z)(this,r)});return a.\u0275fac=function(n){return new(n||a)},a.\u0275mod=e.oAB({type:a}),a.\u0275inj=e.cJS({imports:[[le.Bz.forChild(Fn)],le.Bz]}),a}(),An=c(89936),kn=c(28364),Bn=c(70167),Zn=c(4806),Nn=c(94579),Dn=c(58),En=function(){var a=(0,y.Z)(function r(){(0,P.Z)(this,r)});return a.\u0275fac=function(n){return new(n||a)},a.\u0275mod=e.oAB({type:a}),a.\u0275inj=e.cJS({providers:[v.I,v.FZ,v.CB,v.br,v.BA,v.Zk,v.eB],imports:[[b.ez,Ln,Z.g0,Bn.n,h.ae,L.Wm.withConfig({accessToken:Ze.N.mapboxToken}),Be.o,T.Is,F.ot,j.LD,kn.W,M.u5,M.UX,An.d,A.dp,w.AV,B.p9,Y.Ps,U.Cv,I.aT,ae.Fk,Zn.j,Nn.R,ie.y4,Dn.kN]]}),a}()}}]);