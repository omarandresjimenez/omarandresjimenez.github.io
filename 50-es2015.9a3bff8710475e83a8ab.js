(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{"/gN3":function(e,t,a){"use strict";var i=a("tFIl");class s extends i.a{constructor(e={}){super(),this.momentIsUtc=!1,this.fillAll(e,["order","name","width","minWidth","pinned","field","tooltipField","align","labelFormat","filter","drillIndex","editable","hide","children","valueGetter","valueFormatter","valueSetter","valueParser","momentFormat","momentIsUtc","customFormatter","cellRenderer","cellEditor","cellEditorParams","cellRendererFramework","cellRendererParams","cellClass","data"])}get hasDrill(){return null!==this.drillIndex}get hasNumericFormat(){return this.labelFormat!==l.Date&&this.labelFormat!==l.Moment&&this.labelFormat!==l.Default&&this.labelFormat!==l.Custom}get hasDefaultFormat(){return this.labelFormat===l.Default}get hasMoneyFormat(){return this.labelFormat===l.Money||this.labelFormat===l.Money2}get hasPercentageFormat(){return this.labelFormat===l.Percentage||this.labelFormat===l.Percentage1DecWithZeroMantissa||this.labelFormat===l.Percentage2DecWithZeroMantissa}}var l=function(e){return e[e.Date=0]="Date",e[e.Moment=1]="Moment",e[e.Money=2]="Money",e[e.Money2=3]="Money2",e[e.MoneyAbbr=4]="MoneyAbbr",e[e.Integer=5]="Integer",e[e.Float=6]="Float",e[e.FloatWithTwoDecimalPlaces=7]="FloatWithTwoDecimalPlaces",e[e.FloatWithOneDecimalPlace=8]="FloatWithOneDecimalPlace",e[e.Cnt=9]="Cnt",e[e.Percentage=10]="Percentage",e[e.Percentage1DecWithZeroMantissa=11]="Percentage1DecWithZeroMantissa",e[e.Percentage2DecWithZeroMantissa=12]="Percentage2DecWithZeroMantissa",e[e.Custom=13]="Custom",e[e.Default=14]="Default",e}({}),n=function(e){return e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Center=2]="Center",e}({}),r=function(e){return e[e.None=0]="None",e[e.String=1]="String",e[e.NumberRange=2]="NumberRange",e[e.DateRange=3]="DateRange",e[e.MultiChoice=4]="MultiChoice",e}({});class o{constructor(e={}){Object.keys(e).forEach(t=>this[t]=new.target.value(e[t]))}static value(e,t=null){return null==e?t:e}}a.d(t,"a",(function(){return s})),a.d(t,"d",(function(){return l})),a.d(t,"b",(function(){return n})),a.d(t,"c",(function(){return r})),a.d(t,"e",(function(){return o}))},I0N1:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var i=a("LRne"),s=a("lJxs"),l=a("LL99"),n=a("SeMe"),r=a("VHTt");class o{constructor(e,t){this.dataAdapter=e,this.api=t}getStoreGroups(){return this.api.get("storegroups")}getStores(){return this.api.get("stores").pipe(Object(s.a)(e=>e.map(e=>r.c.fromJson(e))))}getDates(){return this.api.get("kpi/month")}getSummaryData(e){return this.api.get("crms",{params:{group_id:e.store&&e.store!==l.a?null:e.group,store_id:e.store,period:e.dateIndex}}).pipe(Object(s.a)(e=>this.dataAdapter.parseGetSummaryDataResponse(e)))}getDetailsData(e){const t=this.getDetailsUrl(e);return t?this.api.get(`crms/${t}`,{params:this.mapDetailsDataParams(e)}).pipe(Object(s.a)(t=>this.dataAdapter.parseGetDetailsDataResponse(t,e))):Object(i.a)({}).pipe(Object(s.a)(t=>this.dataAdapter.parseGetDetailsDataResponse(t,e)))}getDetailsUrl(e){let t;switch(!0){case e.page===n.b.TrafficManagement:t="traffic-management";break;case e.page===n.b.Appointments&&e.tab===n.d.Summary:t="appointment-summary";break;case e.page===n.b.Appointments&&e.tab===n.d.Activity:t="appointment-activity";break;case e.page===n.b.LeadSources:t="leads"}return t}mapDetailsDataParams(e){const t={group_id:e.store&&e.store!==l.a?null:e.group,store_id:e.store,period:e.dateIndex};let a=!1;return e.filters&&e.filters.forEach(i=>{e.page===n.b.TrafficManagement&&"up_type"===i.name&&"bdc"===i.value?a=!0:i.value&&(t[i.name]=i.value)}),e.page===n.b.TrafficManagement&&(t.report_type=a?2:1),t}}},SeMe:function(e,t,a){"use strict";var i=function(e){return e.TrafficManagement="traffic-management",e.Appointments="appointments",e.SalesPerson="sales-person",e.LeadSources="lead-sources",e.DesklogActivity="desklog-activity",e}({}),s=function(e){return e.DealershipPerformance="dealership-performance",e.Activity="activity",e.BySource="by-source",e.Summary="summary",e}({}),l=a("LvDl");const n={name:"up_type",value:"0",items:[{key:"all",value:"0"},{key:"showroom",value:"20"},{key:"internet",value:"22"},{key:"phone",value:"23"},{key:"campaign",value:"21"}]},r={name:"type",value:"0",items:[{key:"all",value:"0"},{key:"new",value:"N"},{key:"used",value:"U"}]},o={name:"sales-person",value:"0",items:[{label:"All",value:"0"},{label:"Salesperson 1",value:"1"},{label:"Salesperson 2",value:"2"}]},c={name:"department",value:"0",items:[{label:"All",value:"0"},{label:"Department 1",value:"1"},{label:"Department 2",value:"2"}]},u={name:"vehicle-type",value:"0",items:[{label:"All",value:"0"},{label:"Vehicle Type 1",value:"1"},{label:"Vehicle Type 2",value:"2"}]};function d(e,t){let a=[];switch(!0){case e===i.TrafficManagement:const d=l.cloneDeep(n);d.items.push({key:"bdc",value:"bdc"}),a=[d];break;case e===i.Appointments&&t===s.Summary:a=[n];break;case e===i.Appointments&&t===s.Activity:a=[r];break;case e===i.LeadSources:a=[n,r];break;case e===i.DesklogActivity&&t===s.Summary:a=[r];break;case e===i.DesklogActivity&&t===s.Activity:a=[o,c,u]}return l.cloneDeep(a)}var p=a("/gN3");class m extends p.a{constructor(e={}){super(e)}static fromJson(e){const t={name:e.colName,field:e.datafield,align:this.mapColumnAlign(e.align),labelFormat:this.mapLabelFormat(e.lf),filter:this.mapColumnFilter(e.filter,e.lf)};return new m(t)}static isNumericType(e){return-1===["txt","date"].indexOf(e)}static mapLabelFormat(e){const t={date:p.d.Date,amt:p.d.Money,amt2:p.d.Money2,cnt:p.d.Float,reg1:p.d.Float,per:p.d.Percentage,per1:p.d.Percentage1DecWithZeroMantissa,per2:p.d.Percentage2DecWithZeroMantissa,custom:p.d.Custom};return void 0!==t[e]?t[e]:p.d.Default}static mapColumnAlign(e){return{left:p.b.Left,right:p.b.Right,center:p.b.Center}[e]}static mapColumnFilter(e,t){return{amt:p.c.NumberRange,cnt:p.c.NumberRange,reg1:p.c.NumberRange,per:p.c.NumberRange,per1:p.c.NumberRange,per2:p.c.NumberRange}[t]||{none:p.c.String,mRange:p.c.MultiChoice,dRange:p.c.DateRange,nRange:p.c.NumberRange}[e]}}var b=a("tFIl");let h=(()=>{class e extends p.e{constructor(e={}){super(e)}get hasDrill(){return null!==this.drillRowIndex&&(this.drillType===e.DRILL_TYPE_1||this.drillType===e.DRILL_TYPE_NEW||this.drillType===e.DRILL_TYPE_USED)}static fromJson(t){const a={labelFormat:b.b.string(t.lf),labelType:b.b.string(t.lt),drillType:b.b.number(t.drillType),drillRowIndex:b.b.string(t.DrillRowIndx),bold:b.b.boolean(t.bold)},i=["lf","lt","bold","drillType","DrillRowIndx"];return Object.keys(t).filter(e=>-1===i.indexOf(e)).forEach(e=>a[e]=t[e]),new e(a)}}return e.DRILL_TYPE_1=50,e.DRILL_TYPE_2=49,e.DRILL_TYPE_NEW=1,e.DRILL_TYPE_USED=2,e})();a.d(t,"b",(function(){return i})),a.d(t,"d",(function(){return s})),a.d(t,"e",(function(){return d})),a.d(t,"a",(function(){return m})),a.d(t,"c",(function(){return h}))},VHTt:function(e,t,a){"use strict";var i=function(e){return e[e.XLS=0]="XLS",e[e.PDF=1]="PDF",e}({}),s=a("2Vo4"),l=a("PqYM"),n=a("EY2u"),r=a("lJxs"),o=a("eIep"),c=a("vkgz"),u=a("GyhO"),d=a("nYR2");class p{get decrementer(){return()=>this.decrement()}get incrementor(){return()=>this.increment()}get resetter(){return()=>this.reset()}constructor(e=0){this._value$=new s.a(e),this.value$=this._value$.asObservable(),this.is$=this._value$.pipe(Object(r.a)(e=>Boolean(e)))}increment(){this._value$.next(this._value$.getValue()+1)}decrement(){const e=this._value$.getValue();this._value$.next(e>0?e-1:0)}reset(){this._value$.next(0)}streamJoiner(e=!1){return t=>{return(e?Object(l.a)(0).pipe((a=n.a,Object(o.a)(()=>a))):n.a).pipe(Object(c.a)(()=>{},void 0,this.incrementor),function(...e){return t=>t.lift.call(Object(u.a)(t,...e))}(t),Object(d.a)(this.decrementer));var a}}}var m=a("6LW8");a.d(t,"a",(function(){return i})),a.d(t,"b",(function(){return p})),a.d(t,"c",(function(){return m.a}))},ZdgN:function(e,t,a){"use strict";a.r(t);var i=a("8Y7J");class s{constructor(e){e.addLoaderWithPrefixedTranslations("/cabinet/crm","")}}var l=a("pMnS"),n=a("iInd");class r{constructor(e){this.filterData=e}ngOnInit(){this.filterData.init()}ngOnDestroy(){this.filterData.destroy()}}var o=a("nNBh"),c=i["\u0275crt"]({encapsulation:0,styles:[[""]],data:{}});function u(e){return i["\u0275vid"](0,[(e()(),i["\u0275eld"](0,16777216,null,null,1,"router-outlet",[],null,null,null,null,null)),i["\u0275did"](1,212992,null,0,n.t,[n.b,i.ViewContainerRef,i.ComponentFactoryResolver,[8,null],i.ChangeDetectorRef],null,null)],(function(e,t){e(t,1,0)}),null)}function d(e){return i["\u0275vid"](0,[(e()(),i["\u0275eld"](0,0,null,null,1,"ng-component",[],null,null,null,u,c)),i["\u0275did"](1,245760,null,0,r,[o.a],null,null)],(function(e,t){e(t,1,0)}),null)}var p=i["\u0275ccf"]("ng-component",r,d,{},{},[]),m=a("LvDl"),b=a("/kTj"),h=a("SnDi"),g=a("SeMe");class _{constructor(e){this.debug=e.factory(new.target.name,b.a.All)}parseGetSummaryDataResponse(e){return{trafficManagement:m.get(e,"0.data",[]).map(e=>({label:e.title,items:m.get(e,"data",[]).map(e=>({label:e.title,rankGrowth:e.color,graph:{value:e.val1,target:e.val2,percentage:0===e.val2?0:+(e.val1/e.val2*100).toFixed(2),format:"cnt",valueEdit:h.b.fromJson({type:h.a.CRM,fields:m.get(e,"tooltip",[]).map(e=>({id:e.id,uid:e.id,type:e.editable?"input":e.type,field:e.id,label:e.label,value:e.value}))})}}))})),appointments:m.get(e,"1.data",[]).map(e=>({title1:e.title1,title2:e.title2,rankGrowth:e.color,value:e.val1/100,format:"per",graph:{labels:m.get(e,"graph",[]).map(()=>""),data:m.get(e,"graph",[])}})),leadSources:m.get(e,"2.data",[]).map(e=>({label:e.title,rankGrowth:e.color,graph:{value:e.val1,target:e.val2,percentage:0===e.val2?0:+(e.val1/e.val2*100).toFixed(2),format:"cnt",valueEdit:h.b.fromJson({type:h.a.CRM,fields:m.get(e,"tooltip",[]).map(e=>({id:e.id,uid:e.id,type:e.editable?"input":e.type,field:e.id,label:e.label,value:e.value}))})}})),desklogActivity:m.get(e,"4.data",[]).map(e=>({label:e.title,value:e.val1/100,rankGrowth:e.color,format:"per"}))}}parseGetDetailsDataResponse(e,t){if(console.log(t),console.log(e),!e)return{columns:[],rows:[]};let a;switch(!0){case t.page===g.b.TrafficManagement:a=this.parseTrafficManagement(e,t);break;case t.page===g.b.LeadSources:a=this.parseLeadSources(e);break;case t.page===g.b.DesklogActivity:a=this.parseDesklogActivity(e,t.tab);break;default:a={columns:e.columns,rows:e.data}}const i=a.columns.map(e=>g.a.fromJson(e)),s=a.rows.map(e=>g.c.fromJson(e)),l=this.hasTotals(t)?i.map(e=>e.field):[];return{columns:i,rows:s,summaryFields:l}}hasTotals(e){return e.page===g.b.Appointments||e.page===g.b.DesklogActivity}parseTrafficManagement(e,t){const a={},i=[],s=e.columns.slice(1),l=t.filters&&!!t.filters.find(e=>"up_type"===e.name&&"bdc"===e.value);for(const n of e.data){const e=n.store_name,t=l?"N"===n.vehicle_sought_type?"New":"Used":n.deal_category_desc;a[e]?s.forEach(t=>{g.a.isNumericType(t.lf)&&(a[e][t.datafield]=+a[e][t.datafield]+ +n[t.datafield])}):a[e]=Object.assign({children:{},bold:!0,treeDataNodes:[e],"ag-Grid-AutoColumn":e},n),a[e].children[t]?s.forEach(i=>{g.a.isNumericType(i.lf)&&(a[e].children[t][i.datafield]=+a[e].children[t][i.datafield]+ +n[i.datafield])}):a[e].children[t]=Object.assign({treeDataNodes:[e,t],"ag-Grid-AutoColumn":t},n)}for(const n of Object.keys(a)){i.push(a[n]);for(const e of Object.keys(a[n].children))i.push(a[n].children[e])}return{columns:s,rows:i}}parseLeadSources(e){const t=e.columns,a=[];let i;return e.data.forEach((s,l)=>{i&&i.deal_category_id===s.deal_category_id?t.forEach(e=>{g.a.isNumericType(e.lf)&&(i[e.datafield]=+i[e.datafield]+ +s[e.datafield])}):(i&&i.deal_category_id!==s.deal_category_id&&a.push(i),i=Object.assign({},s,{bold:!0,deal_source_desc:"Subtotal"})),a.push(s),l===e.data.length-1&&a.push(i)}),{columns:t,rows:a}}parseDesklogActivity(e,t){const a={columns:[{colnum:"1",colName:"Company",datafield:"company",width:null,lf:"title",Round:null,align:"left",filter:"none"},{colnum:"2",colName:"Showroom Visits",datafield:"showroom_visits",width:null,lf:"cnt",Round:null,align:"right",filter:"none"},{colnum:"3",colName:"Phone Visits",datafield:"phone_visits",width:null,lf:"cnt",Round:null,align:"right",filter:"none"},{colnum:"4",colName:"Internet Visits",datafield:"internet_visits",width:null,lf:"cnt",Round:null,align:"right",filter:"none"},{colnum:"5",colName:"Campaign Visits",datafield:"campaign_visits",width:null,lf:"cnt",Round:null,align:"right",filter:"none"},{colnum:"6",colName:"Total Visits",datafield:"total_visits",width:null,lf:"cnt",Round:null,align:"right",filter:"none"},{colnum:"7",colName:"Sold",datafield:"sold",width:null,lf:"cnt",Round:null,align:"right",filter:"none"},{colnum:"8",colName:"% Closing",datafield:"closing",width:null,lf:"per",Round:null,align:"right",filter:"none"},{colnum:"9",colName:"Be back",datafield:"be_back",width:null,lf:"cnt",Round:null,align:"right",filter:"none"},{colnum:"10",colName:"% Be back",datafield:"be_back_per",width:null,lf:"per",Round:null,align:"right",filter:"none"},{colnum:"11",colName:"Be Back Sold",datafield:"be_back_sold",width:null,lf:"cnt",Round:null,align:"right",filter:"none"},{colnum:"12",colName:"% Be Back Sold",datafield:"be_back_sold_per",width:null,lf:"per",Round:null,align:"right",filter:"none"}]};return a.rows=t===g.d.Summary?[{company:"Alamo Acura",showroom_visits:41,phone_visits:8,internet_visits:27,campaign_visits:5,total_visits:81,sold:21,closing:.1981,be_back:25,be_back_per:.2358,be_back_sold:7,be_back_sold_per:.28},{company:"Banning Hyundai",showroom_visits:63,phone_visits:17,internet_visits:38,campaign_visits:8,total_visits:126,sold:39,closing:.2635,be_back:22,be_back_per:.1486,be_back_sold:9,be_back_sold_per:.4091},{company:"Alameda Honda",showroom_visits:73,phone_visits:58,internet_visits:50,campaign_visits:9,total_visits:190,sold:76,closing:.3486,be_back:28,be_back_per:.1284,be_back_sold:16,be_back_sold_per:.5714},{company:"Boston Mazda",showroom_visits:184,phone_visits:45,internet_visits:120,campaign_visits:12,total_visits:361,sold:138,closing:.3144,be_back:78,be_back_per:.1777,be_back_sold:19,be_back_sold_per:.2436},{company:"Bay Area Chevy",showroom_visits:70,phone_visits:43,internet_visits:71,campaign_visits:9,total_visits:193,sold:113,closing:.5022,be_back:32,be_back_per:.1422,be_back_sold:19,be_back_sold_per:.5938},{company:"Chicago Toyota",showroom_visits:42,phone_visits:26,internet_visits:37,campaign_visits:10,total_visits:115,sold:46,closing:.3433,be_back:19,be_back_per:.1418,be_back_sold:8,be_back_sold_per:.4211},{company:"Maui Honda",showroom_visits:30,phone_visits:7,internet_visits:12,campaign_visits:2,total_visits:51,sold:13,closing:.197,be_back:15,be_back_per:.2273,be_back_sold:4,be_back_sold_per:.2667}]:[{company:"Alamo Acura",showroom_visits:0,phone_visits:1,internet_visits:0,campaign_visits:0,total_visits:2,sold:2,closing:.2222,be_back:0,be_back_per:.2358,be_back_sold:7,be_back_sold_per:.28},{company:"Banning Hyundai",showroom_visits:1,phone_visits:3,internet_visits:0,campaign_visits:4,total_visits:32,sold:3.5,closing:.5833,be_back:0,be_back_per:.1486,be_back_sold:9,be_back_sold_per:.4091},{company:"Alameda Honda",showroom_visits:0,phone_visits:0,internet_visits:0,campaign_visits:0,total_visits:45,sold:2.5,closing:.1786,be_back:0,be_back_per:.1777,be_back_sold:19,be_back_sold_per:.2436},{company:"Boston Mazda",showroom_visits:0,phone_visits:0,internet_visits:1,campaign_visits:0,total_visits:44,sold:0,closing:0,be_back:5,be_back_per:.1777,be_back_sold:19,be_back_sold_per:.2236},{company:"Bay Area Chevy",showroom_visits:0,phone_visits:0,internet_visits:0,campaign_visits:0,total_visits:82,sold:8.5,closing:.6071,be_back:8,be_back_per:.1422,be_back_sold:19,be_back_sold_per:.5938},{company:"Chicago Toyota",showroom_visits:0,phone_visits:0,internet_visits:1,campaign_visits:0,total_visits:37,sold:1,closing:.1429,be_back:1,be_back_per:.1418,be_back_sold:8,be_back_sold_per:.4211},{company:"Maui Honda",showroom_visits:0,phone_visits:1,internet_visits:0,campaign_visits:1,total_visits:10,sold:1.5,closing:.375,be_back:1,be_back_per:.2273,be_back_sold:4,be_back_sold_per:.2667},{company:"Richmond Mazda",showroom_visits:0,phone_visits:0,internet_visits:0,campaign_visits:0,total_visits:32,sold:10,closing:.5556,be_back:0,be_back_per:.2358,be_back_sold:7,be_back_sold_per:.28}],a}}var f=a("I0N1"),v=a("Qq/Z"),y=a("TSSN"),k=a("jMGS"),D=a("XpwZ"),w=a("aBBA");const S=()=>Promise.all([a.e(3),a.e(4),a.e(6),a.e(10),a.e(11),a.e(9),a.e(15),a.e(19),a.e(22),a.e(25),a.e(57)]).then(a.bind(null,"r06V")).then(e=>e.CrmSummaryModuleNgFactory),R=()=>Promise.all([a.e(0),a.e(3),a.e(4),a.e(2),a.e(5),a.e(6),a.e(10),a.e(8),a.e(11),a.e(12),a.e(15),a.e(17),a.e(25),a.e(56)]).then(a.bind(null,"L1UN")).then(e=>e.CrmDetailsModuleNgFactory);a.d(t,"CrmModuleNgFactory",(function(){return M}));var M=i["\u0275cmf"](s,[],(function(e){return i["\u0275mod"]([i["\u0275mpd"](512,i.ComponentFactoryResolver,i["\u0275CodegenComponentFactoryResolver"],[[8,[l.a,p]],[3,i.ComponentFactoryResolver],i.NgModuleRef]),i["\u0275mpd"](4608,_,_,[b.b]),i["\u0275mpd"](4608,f.a,f.a,[_,v.a]),i["\u0275mpd"](4608,o.a,o.a,[y.j,k.a,f.a,D.a]),i["\u0275mpd"](1073742336,n.s,n.s,[[2,n.x],[2,n.o]]),i["\u0275mpd"](1073742336,s,s,[w.a]),i["\u0275mpd"](1024,n.m,(function(){return[[{path:"",component:r,children:[{path:"summary",loadChildren:S},{path:"details",loadChildren:R},{path:"",redirectTo:"summary",pathMatch:"full"}]}]]}),[])])}))},nNBh:function(e,t,a){"use strict";a.d(t,"a",(function(){return p}));var i=a("2Vo4"),s=a("fFD9"),l=a("pLZG"),n=a("lJxs"),r=a("UXun"),o=a("SxV6"),c=a("vkgz"),u=a("wd/R"),d=a("LL99");class p{constructor(e,t,a,s){this.translate=e,this.userApi=t,this.dataApi=a,this.instanceAppSettingsApi=s,this._value$=new i.a(void 0),this.filterGroupDef$=new i.a(void 0),this.filterStoreDef$=new i.a(void 0),this.filterDateDef$=new i.a(void 0),this.months$=new i.a(void 0),this.storeGroups$=new i.a(void 0),this.stores$=new i.a(void 0),this.subs=[],this.initStreams()}set sub(e){this.subs.push(e)}init(){this.initSubscriptions()}destroy(){this.subs.forEach(e=>e.unsubscribe()),this.subs=[]}updateFilter(e){switch(e.name){case"group":this.updateGroup({group:e.value});break;case"store":this.updateStore({store:e.value});break;case"date":this.updateDate({date:e.value})}}updateValue(e){const t=this._value$.getValue(),a=t?t.clone(e):new d.c(e);this._value$.next(a)}updateGroup(e){e.store=d.a;const t=this.filterStoreDef$.getValue();let a;a=e.group===d.a?this.stores$.getValue():this.storeGroups$.getValue().find(t=>t.value===e.group).data,this.filterStoreDef$.next(Object(d.f)("store",a,t.label)),this.updateValue(e)}updateStore(e){if(this._value$.getValue().group===d.a){const t=this.storeGroups$.getValue().find(t=>t.data&&!!t.data.find(t=>t.value===e.store));t&&(e.group=t.value)}this.updateValue(e)}updateDate(e){const t=this.months$.getValue(),[a,i]=e.date.split("-"),s=t.find(e=>+e.year==+a&&+e.month==+i);s&&this.updateValue({date:e.date,dateIndex:s.dateIndex})}getFiltersExportSnapshot(){const e=this.filterGroupDef$.getValue(),t=this.filterStoreDef$.getValue(),a=this.filterDateDef$.getValue(),i=this._value$.getValue();if(!(e&&t&&a&&i))return[];const s=e.items.find(e=>e.value===i.group),l=t.items.find(e=>e.value===i.store);return[{label:e.label,value:s&&s.label||""},{label:t.label,value:l&&l.label||""},{label:a.label,value:u(i.date).format("MMMM YYYY")||""}]}initStreams(){this.filtersDef$=this.filterGroupDef$.pipe(Object(s.a)(this.filterStoreDef$,this.filterDateDef$),Object(l.a)(([e,t,a])=>!!e&&!!t&&!!a),Object(n.a)(([e,t,a])=>[e,t,a]),Object(r.a)(1)),this.value$=this._value$.pipe(Object(s.a)(this.filtersDef$.pipe(Object(o.a)())),Object(l.a)(([e,t])=>!!t&&!!e),Object(n.a)(([e])=>e))}initSubscriptions(){this.sub=this.dataApi.getStoreGroups().pipe(Object(s.a)(this.dataApi.getStores(),this.dataApi.getDates(),this.instanceAppSettingsApi.getByType("pages.all.main"),this.translate.get(["filters-group.business-segment.label","filters-group.business-segment.item.all.label","filters-group.store.label","filters-group.store.item.all.label","filters-group.period.label"])),Object(n.a)(([e,t,a,i,s])=>{const l=t.map(e=>({label:e[i?i.storeNameType:"name"],value:String(e.id),position:e.position}));l.unshift({label:s["filters-group.store.item.all.label"],value:d.a});const n=e.map(e=>({label:e.name,value:String(e.groupIndex),data:l.filter(t=>t.value===d.a||!!e.stores.find(e=>+e.store_id==+t.value))}));n.unshift({label:s["filters-group.business-segment.item.all.label"],value:d.a});const r=a.map(e=>{const[t,a,i]=e.date_from.split("/");return{month:t,year:i,date:`${i}-${t}-${a}`,dateIndex:e.dateindex}});return{stores:l,storeGroups:n,months:r,t:s}}),Object(c.a)(({stores:e,storeGroups:t,months:a})=>this.updateValue({group:t[0].value,store:e[0].value,date:a[0].date,dateIndex:a[0].dateIndex}))).subscribe(({stores:e,storeGroups:t,months:a,t:i})=>{this.storeGroups$.next(t),this.stores$.next(e),this.months$.next(a),this.filterGroupDef$.next(Object(d.f)("group",t,i["filters-group.business-segment.label"])),this.filterStoreDef$.next(Object(d.f)("store",e,i["filters-group.store.label"])),this.filterDateDef$.next(Object(d.e)("date",i["filters-group.period.label"],d.b.DateMonth,a[a.length-1].date,a[0].date))})}}}}]);